{"version":3,"sources":["../src/talk_to_figma_mcp/server.ts"],"sourcesContent":["#!/usr/bin/env node\n\nimport { McpServer } from \"@modelcontextprotocol/sdk/server/mcp.js\";\nimport { StdioServerTransport } from \"@modelcontextprotocol/sdk/server/stdio.js\";\nimport { z } from \"zod\";\nimport WebSocket from \"ws\";\nimport { v4 as uuidv4 } from \"uuid\";\n\n// ─── Coercion helpers ───────────────────────────────────────────────\n// AI agents (Claude, GPT, etc.) frequently pass numbers as strings\n// (\"10\" instead of 10), booleans as strings (\"true\" instead of true),\n// and objects/arrays as JSON strings. These helpers add resilient\n// coercion so tools don't fail on valid-but-mistyped input.\n\n/** Coerce \"true\"/\"false\"/\"1\"/\"0\" strings to boolean */\nconst flexBool = <T extends z.ZodTypeAny>(inner: T) =>\n  z.preprocess((v) => {\n    if (v === 'true' || v === '1') return true;\n    if (v === 'false' || v === '0') return false;\n    return v;\n  }, inner);\n\n/** Coerce JSON strings to parsed values (for objects/arrays that agents may stringify) */\nconst flexJson = <T extends z.ZodTypeAny>(inner: T) =>\n  z.preprocess((v) => {\n    if (typeof v === 'string') {\n      try { return JSON.parse(v); } catch { return v; }\n    }\n    return v;\n  }, inner);\n\n/** Coerce numeric strings only when they're valid numbers (safe for use inside unions) */\nconst flexNum = <T extends z.ZodTypeAny>(inner: T) =>\n  z.preprocess((v) => {\n    if (typeof v === 'string') {\n      const n = Number(v);\n      if (!isNaN(n) && v.trim() !== '') return n;\n    }\n    return v;\n  }, inner);\n\n// Define TypeScript interfaces for Figma responses\ninterface FigmaResponse {\n  id: string;\n  result?: any;\n  error?: string;\n}\n\n// Define interface for command progress updates\ninterface CommandProgressUpdate {\n  type: 'command_progress';\n  commandId: string;\n  commandType: string;\n  status: 'started' | 'in_progress' | 'completed' | 'error';\n  progress: number;\n  totalItems: number;\n  processedItems: number;\n  currentChunk?: number;\n  totalChunks?: number;\n  chunkSize?: number;\n  message: string;\n  payload?: any;\n  timestamp: number;\n}\n\n// Update the getInstanceOverridesResult interface to match the plugin implementation\ninterface getInstanceOverridesResult {\n  success: boolean;\n  message: string;\n  sourceInstanceId: string;\n  mainComponentId: string;\n  overridesCount: number;\n}\n\n// Custom logging functions that write to stderr instead of stdout to avoid being captured\nconst logger = {\n  info: (message: string) => process.stderr.write(`[INFO] ${message}\\n`),\n  debug: (message: string) => process.stderr.write(`[DEBUG] ${message}\\n`),\n  warn: (message: string) => process.stderr.write(`[WARN] ${message}\\n`),\n  error: (message: string) => process.stderr.write(`[ERROR] ${message}\\n`),\n  log: (message: string) => process.stderr.write(`[LOG] ${message}\\n`)\n};\n\n// WebSocket connection and request tracking\nlet ws: WebSocket | null = null;\nconst pendingRequests = new Map<string, {\n  resolve: (value: unknown) => void;\n  reject: (reason: unknown) => void;\n  timeout: ReturnType<typeof setTimeout>;\n  lastActivity: number; // Add timestamp for last activity\n}>();\n\n// Track which channel each client is in\nlet currentChannel: string | null = null;\n\n// Create MCP server\nconst server = new McpServer({\n  name: \"TalkToFigmaMCP\",\n  version: \"1.0.0\",\n});\n\n// Add command line argument parsing\nconst args = process.argv.slice(2);\nconst serverArg = args.find(arg => arg.startsWith('--server='));\nconst serverUrl = serverArg ? serverArg.split('=')[1] : 'localhost';\nconst WS_URL = serverUrl === 'localhost' ? `ws://${serverUrl}` : `wss://${serverUrl}`;\n\n// Document Info Tool\nserver.tool(\n  \"get_document_info\",\n  \"Get information about the current Figma document including all pages and top-level children of the current page.\",\n  {\n    depth: z.coerce.number().optional().describe(\"How many levels of children to include on the current page. 0 or omit for top-level only, 1 includes grandchildren names.\"),\n  },\n  async ({ depth }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"get_document_info\", { depth });\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: JSON.stringify(result)\n          }\n        ]\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error getting document info: ${error instanceof Error ? error.message : String(error)\n              }`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Selection Tool\nserver.tool(\n  \"get_selection\",\n  \"Get information about the current selection in Figma\",\n  {},\n  async () => {\n    try {\n      const result = await sendCommandToFigma(\"get_selection\");\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: JSON.stringify(result)\n          }\n        ]\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error getting selection: ${error instanceof Error ? error.message : String(error)\n              }`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Read My Design Tool\nserver.tool(\n  \"read_my_design\",\n  \"Get detailed information about the current selection in Figma, including all node details. Use depth to control traversal.\",\n  {\n    depth: z.coerce.number().optional().describe(\"How many levels of children to recurse. 0=selection nodes only, 1=direct children, -1 or omit for unlimited.\"),\n  },\n  async ({ depth }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"read_my_design\", { depth });\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: JSON.stringify(result)\n          }\n        ]\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error getting node info: ${error instanceof Error ? error.message : String(error)\n              }`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Node Info Tool\nserver.tool(\n  \"get_node_info\",\n  \"Get detailed information about a specific node in Figma. Use depth to control how many levels of children to include (0=node only with child summaries, 1=direct children, -1=unlimited).\",\n  {\n    nodeId: z.string().describe(\"The ID of the node to get information about\"),\n    depth: z.coerce.number().optional().describe(\"How many levels of children to recurse into. 0=node only with child name/type stubs, 1=direct children fully, 2=grandchildren, etc. -1 or omit for unlimited depth.\"),\n  },\n  async ({ nodeId, depth }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"get_node_info\", { nodeId, depth });\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: JSON.stringify(filterFigmaNode(result, depth !== undefined ? depth : -1))\n          }\n        ]\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error getting node info: ${error instanceof Error ? error.message : String(error)\n              }`,\n          },\n        ],\n      };\n    }\n  }\n);\n\nfunction rgbaToHex(color: any): string {\n  // skip if color is already hex\n  if (color.startsWith('#')) {\n    return color;\n  }\n\n  const r = Math.round(color.r * 255);\n  const g = Math.round(color.g * 255);\n  const b = Math.round(color.b * 255);\n  const a = Math.round(color.a * 255);\n\n  return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}${a === 255 ? '' : a.toString(16).padStart(2, '0')}`;\n}\n\nfunction filterFigmaNode(node: any, depth: number = -1, currentDepth: number = 0) {\n  // Skip VECTOR type nodes\n  if (node.type === \"VECTOR\") {\n    return null;\n  }\n\n  const filtered: any = {\n    id: node.id,\n    name: node.name,\n    type: node.type,\n  };\n\n  // Preserve parent info if present (injected by plugin's getNodeInfo)\n  if (currentDepth === 0) {\n    if (node.parentId) filtered.parentId = node.parentId;\n    if (node.parentName) filtered.parentName = node.parentName;\n    if (node.parentType) filtered.parentType = node.parentType;\n  }\n\n  if (node.fills && node.fills.length > 0) {\n    filtered.fills = node.fills.map((fill: any) => {\n      const processedFill = { ...fill };\n\n      // Remove boundVariables and imageRef\n      delete processedFill.boundVariables;\n      delete processedFill.imageRef;\n\n      // Process gradientStops if present\n      if (processedFill.gradientStops) {\n        processedFill.gradientStops = processedFill.gradientStops.map((stop: any) => {\n          const processedStop = { ...stop };\n          // Convert color to hex if present\n          if (processedStop.color) {\n            processedStop.color = rgbaToHex(processedStop.color);\n          }\n          // Remove boundVariables\n          delete processedStop.boundVariables;\n          return processedStop;\n        });\n      }\n\n      // Convert solid fill colors to hex\n      if (processedFill.color) {\n        processedFill.color = rgbaToHex(processedFill.color);\n      }\n\n      return processedFill;\n    });\n  }\n\n  if (node.strokes && node.strokes.length > 0) {\n    filtered.strokes = node.strokes.map((stroke: any) => {\n      const processedStroke = { ...stroke };\n      // Remove boundVariables\n      delete processedStroke.boundVariables;\n      // Convert color to hex if present\n      if (processedStroke.color) {\n        processedStroke.color = rgbaToHex(processedStroke.color);\n      }\n      return processedStroke;\n    });\n  }\n\n  if (node.cornerRadius !== undefined) {\n    filtered.cornerRadius = node.cornerRadius;\n  }\n\n  if (node.absoluteBoundingBox) {\n    filtered.absoluteBoundingBox = node.absoluteBoundingBox;\n  }\n\n  if (node.characters) {\n    filtered.characters = node.characters;\n  }\n\n  if (node.style) {\n    filtered.style = {\n      fontFamily: node.style.fontFamily,\n      fontStyle: node.style.fontStyle,\n      fontWeight: node.style.fontWeight,\n      fontSize: node.style.fontSize,\n      textAlignHorizontal: node.style.textAlignHorizontal,\n      letterSpacing: node.style.letterSpacing,\n      lineHeightPx: node.style.lineHeightPx\n    };\n  }\n\n  // Effects\n  if (node.effects && node.effects.length > 0) {\n    filtered.effects = node.effects;\n  }\n\n  // Layout properties\n  if (node.layoutMode !== undefined) {\n    filtered.layoutMode = node.layoutMode;\n  }\n  if (node.itemSpacing !== undefined) {\n    filtered.itemSpacing = node.itemSpacing;\n  }\n  if (node.paddingLeft !== undefined) {\n    filtered.padding = {\n      left: node.paddingLeft,\n      right: node.paddingRight,\n      top: node.paddingTop,\n      bottom: node.paddingBottom,\n    };\n  }\n\n  // Opacity and visibility\n  if (node.opacity !== undefined && node.opacity !== 1) {\n    filtered.opacity = node.opacity;\n  }\n  if (node.visible !== undefined && node.visible === false) {\n    filtered.visible = false;\n  }\n\n  // Constraints\n  if (node.constraints) {\n    filtered.constraints = node.constraints;\n  }\n\n  if (node.children) {\n    // If depth is limited and we've reached the limit, return child summaries only\n    if (depth >= 0 && currentDepth >= depth) {\n      filtered.children = node.children.map((child: any) => ({\n        id: child.id,\n        name: child.name,\n        type: child.type,\n      }));\n    } else {\n      filtered.children = node.children\n        .map((child: any) => filterFigmaNode(child, depth, currentDepth + 1))\n        .filter((child: any) => child !== null);\n    }\n  }\n\n  return filtered;\n}\n\n// Nodes Info Tool\nserver.tool(\n  \"get_nodes_info\",\n  \"Get detailed information about multiple nodes in Figma. Use depth to control child traversal.\",\n  {\n    nodeIds: flexJson(z.array(z.string())).describe(\"Array of node IDs. Example: [\\\"1:2\\\",\\\"1:3\\\"]\"),\n    depth: z.coerce.number().optional().describe(\"How many levels of children to recurse. 0=nodes only, 1=direct children, -1 or omit for unlimited.\"),\n  },\n  async ({ nodeIds, depth }: any) => {\n    try {\n      const results = await Promise.all(\n        nodeIds.map(async (nodeId: any) => {\n          const result = await sendCommandToFigma('get_node_info', { nodeId, depth });\n          return { nodeId, info: result };\n        })\n      );\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: JSON.stringify(results.map((result) => filterFigmaNode(result.info, depth !== undefined ? depth : -1)))\n          }\n        ]\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error getting nodes info: ${error instanceof Error ? error.message : String(error)\n              }`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n\n// Create Rectangle Tool\nserver.tool(\n  \"create_rectangle\",\n  \"Create a new rectangle in Figma. Default: white fill (Figma native).\",\n  {\n    x: z.coerce.number().optional().describe(\"X position (default: 0)\"),\n    y: z.coerce.number().optional().describe(\"Y position (default: 0)\"),\n    width: z.coerce.number().optional().describe(\"Width (default: 100)\"),\n    height: z.coerce.number().optional().describe(\"Height (default: 100)\"),\n    name: z.string().optional().describe(\"Name for the rectangle (default: 'Rectangle')\"),\n    parentId: z\n      .string()\n      .optional()\n      .describe(\"Parent node ID to append into\"),\n  },\n  async ({ x, y, width, height, name, parentId }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"create_rectangle\", {\n        x,\n        y,\n        width,\n        height,\n        name,\n        parentId,\n      });\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Created rectangle \"${JSON.stringify(result)}\"`,\n          },\n        ],\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error creating rectangle: ${error instanceof Error ? error.message : String(error)\n              }`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Create Frame Tool\nserver.tool(\n  \"create_frame\",\n  \"Create a new frame in Figma. Default: transparent fill, no stroke, no auto-layout.\",\n  {\n    x: z.coerce.number().optional().describe(\"X position (default: 0)\"),\n    y: z.coerce.number().optional().describe(\"Y position (default: 0)\"),\n    width: z.coerce.number().optional().describe(\"Width (default: 100)\"),\n    height: z.coerce.number().optional().describe(\"Height (default: 100)\"),\n    name: z.string().optional().describe(\"Name for the frame (default: 'Frame')\"),\n    parentId: z\n      .string()\n      .optional()\n      .describe(\"Parent node ID to append into\"),\n    fillColor: flexJson(z\n      .object({\n        r: z.coerce.number().min(0).max(1),\n        g: z.coerce.number().min(0).max(1),\n        b: z.coerce.number().min(0).max(1),\n        a: z.coerce.number().min(0).max(1).optional(),\n      })\n      .optional()\n    ).describe(\"Fill color RGBA (0-1 each). Default: transparent. Example: {\\\"r\\\":1,\\\"g\\\":1,\\\"b\\\":1} for white\"),\n    strokeColor: flexJson(z\n      .object({\n        r: z.coerce.number().min(0).max(1),\n        g: z.coerce.number().min(0).max(1),\n        b: z.coerce.number().min(0).max(1),\n        a: z.coerce.number().min(0).max(1).optional(),\n      })\n      .optional()\n    ).describe(\"Stroke color RGBA (0-1 each). Default: no stroke. Example: {\\\"r\\\":0,\\\"g\\\":0,\\\"b\\\":0}\"),\n    strokeWeight: z.coerce.number().positive().optional().describe(\"Stroke weight. Only applied if strokeColor is set.\"),\n    layoutMode: z.enum([\"NONE\", \"HORIZONTAL\", \"VERTICAL\"]).optional().describe(\"Auto-layout direction (default: NONE). The following layout params only apply when not NONE.\"),\n    layoutWrap: z.enum([\"NO_WRAP\", \"WRAP\"]).optional().describe(\"Wrap children (default: NO_WRAP)\"),\n    paddingTop: z.coerce.number().optional().describe(\"Top padding (default: 0)\"),\n    paddingRight: z.coerce.number().optional().describe(\"Right padding (default: 0)\"),\n    paddingBottom: z.coerce.number().optional().describe(\"Bottom padding (default: 0)\"),\n    paddingLeft: z.coerce.number().optional().describe(\"Left padding (default: 0)\"),\n    primaryAxisAlignItems: z\n      .enum([\"MIN\", \"MAX\", \"CENTER\", \"SPACE_BETWEEN\"])\n      .optional()\n      .describe(\"Primary axis alignment (default: MIN). SPACE_BETWEEN overrides itemSpacing.\"),\n    counterAxisAlignItems: z.enum([\"MIN\", \"MAX\", \"CENTER\", \"BASELINE\"]).optional().describe(\"Counter axis alignment (default: MIN)\"),\n    layoutSizingHorizontal: z.enum([\"FIXED\", \"HUG\", \"FILL\"]).optional().describe(\"Horizontal sizing (default: FIXED)\"),\n    layoutSizingVertical: z.enum([\"FIXED\", \"HUG\", \"FILL\"]).optional().describe(\"Vertical sizing (default: FIXED)\"),\n    itemSpacing: z\n      .number()\n      .optional()\n      .describe(\"Spacing between children (default: 0). Ignored if primaryAxisAlignItems is SPACE_BETWEEN.\")\n  },\n  async ({\n    x,\n    y,\n    width,\n    height,\n    name,\n    parentId,\n    fillColor,\n    strokeColor,\n    strokeWeight,\n    layoutMode,\n    layoutWrap,\n    paddingTop,\n    paddingRight,\n    paddingBottom,\n    paddingLeft,\n    primaryAxisAlignItems,\n    counterAxisAlignItems,\n    layoutSizingHorizontal,\n    layoutSizingVertical,\n    itemSpacing\n  }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"create_frame\", {\n        x,\n        y,\n        width,\n        height,\n        name,\n        parentId,\n        fillColor,\n        strokeColor: strokeColor,\n        strokeWeight: strokeWeight,\n        layoutMode,\n        layoutWrap,\n        paddingTop,\n        paddingRight,\n        paddingBottom,\n        paddingLeft,\n        primaryAxisAlignItems,\n        counterAxisAlignItems,\n        layoutSizingHorizontal,\n        layoutSizingVertical,\n        itemSpacing\n      });\n      const typedResult = result as { name: string; id: string };\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Created frame \"${typedResult.name}\" with ID: ${typedResult.id}. Use the ID as the parentId to appendChild inside this frame.`,\n          },\n        ],\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error creating frame: ${error instanceof Error ? error.message : String(error)\n              }`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Create Text Tool\nserver.tool(\n  \"create_text\",\n  \"Create a new text element in Figma. Uses Inter font family. When placing inside an auto-layout parent, set layoutSizingHorizontal to FILL so the text wraps to the parent width.\",\n  {\n    x: z.coerce.number().optional().describe(\"X position (default: 0)\"),\n    y: z.coerce.number().optional().describe(\"Y position (default: 0)\"),\n    text: z.string().describe(\"Text content\"),\n    fontSize: z.coerce.number().optional().describe(\"Font size (default: 14)\"),\n    fontWeight: z.coerce\n      .number()\n      .optional()\n      .describe(\"Font weight (default: 400). Values: 100=Thin, 200=Extra Light, 300=Light, 400=Regular, 500=Medium, 600=Semi Bold, 700=Bold, 800=Extra Bold, 900=Black\"),\n    fontColor: flexJson(z\n      .object({\n        r: z.coerce.number().min(0).max(1),\n        g: z.coerce.number().min(0).max(1),\n        b: z.coerce.number().min(0).max(1),\n        a: z.coerce.number().min(0).max(1).optional(),\n      })\n      .optional()\n    ).describe(\"Font color RGBA (0-1 each). Default: black. Example: {\\\"r\\\":1,\\\"g\\\":0,\\\"b\\\":0} for red\"),\n    name: z\n      .string()\n      .optional()\n      .describe(\"Layer name (default: uses text content)\"),\n    parentId: z\n      .string()\n      .optional()\n      .describe(\"Parent node ID to append into\"),\n    textStyleId: z.string().optional().describe(\"Text style ID to apply (from create_text_style or get_styles). Overrides fontSize/fontWeight.\"),\n    layoutSizingHorizontal: z.enum([\"FIXED\", \"HUG\", \"FILL\"]).optional().describe(\"Horizontal sizing. Use FILL to stretch to parent width (common for text in auto-layout). Automatically sets textAutoResize to HEIGHT when FILL is used.\"),\n    layoutSizingVertical: z.enum([\"FIXED\", \"HUG\", \"FILL\"]).optional().describe(\"Vertical sizing (default: HUG)\"),\n    textAutoResize: z.enum([\"NONE\", \"WIDTH_AND_HEIGHT\", \"HEIGHT\", \"TRUNCATE\"]).optional().describe(\"Text auto-resize behavior. WIDTH_AND_HEIGHT (default) shrinks to fit. HEIGHT = fixed/fill width, auto height (set automatically when layoutSizingHorizontal is FILL). NONE = fixed size. TRUNCATE = fixed size with ellipsis.\"),\n  },\n  async ({ x, y, text, fontSize, fontWeight, fontColor, name, parentId, textStyleId, layoutSizingHorizontal, layoutSizingVertical, textAutoResize }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"create_text\", {\n        x,\n        y,\n        text,\n        fontSize: fontSize !== undefined ? fontSize : 14,\n        fontWeight: fontWeight !== undefined ? fontWeight : 400,\n        fontColor: fontColor || { r: 0, g: 0, b: 0, a: 1 },\n        name,\n        parentId,\n        textStyleId,\n        layoutSizingHorizontal,\n        layoutSizingVertical,\n        textAutoResize,\n      });\n      const typedResult = result as { name: string; id: string };\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Created text \"${typedResult.name}\" with ID: ${typedResult.id}`,\n          },\n        ],\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error creating text: ${error instanceof Error ? error.message : String(error)\n              }`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Set Fill Color Tool\nserver.tool(\n  \"set_fill_color\",\n  \"Set the fill color of a node in Figma can be TextNode or FrameNode\",\n  {\n    nodeId: z.string().describe(\"The ID of the node to modify\"),\n    r: z.coerce.number().min(0).max(1).describe(\"Red component (0-1)\"),\n    g: z.coerce.number().min(0).max(1).describe(\"Green component (0-1)\"),\n    b: z.coerce.number().min(0).max(1).describe(\"Blue component (0-1)\"),\n    a: z.coerce.number().min(0).max(1).optional().describe(\"Alpha component (0-1, default: 1)\"),\n  },\n  async ({ nodeId, r, g, b, a }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"set_fill_color\", {\n        nodeId,\n        color: { r, g, b, a: a !== undefined ? a : 1 },\n      });\n      const typedResult = result as { name: string };\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Set fill color of node \"${typedResult.name\n              }\" to RGBA(${r}, ${g}, ${b}, ${a !== undefined ? a : 1})`,\n          },\n        ],\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error setting fill color: ${error instanceof Error ? error.message : String(error)\n              }`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Set Stroke Color Tool\nserver.tool(\n  \"set_stroke_color\",\n  \"Set the stroke color of a node in Figma\",\n  {\n    nodeId: z.string().describe(\"The ID of the node to modify\"),\n    r: z.coerce.number().min(0).max(1).describe(\"Red component (0-1)\"),\n    g: z.coerce.number().min(0).max(1).describe(\"Green component (0-1)\"),\n    b: z.coerce.number().min(0).max(1).describe(\"Blue component (0-1)\"),\n    a: z.coerce.number().min(0).max(1).optional().describe(\"Alpha component (0-1, default: 1)\"),\n    weight: z.coerce.number().positive().optional().describe(\"Stroke weight (default: 1)\"),\n  },\n  async ({ nodeId, r, g, b, a, weight }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"set_stroke_color\", {\n        nodeId,\n        color: { r, g, b, a: a !== undefined ? a : 1 },\n        weight: weight !== undefined ? weight : 1,\n      });\n      const typedResult = result as { name: string };\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Set stroke color of node \"${typedResult.name\n              }\" to RGBA(${r}, ${g}, ${b}, ${a !== undefined ? a : 1}) with weight ${weight !== undefined ? weight : 1}`,\n          },\n        ],\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error setting stroke color: ${error instanceof Error ? error.message : String(error)\n              }`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Move Node Tool\nserver.tool(\n  \"move_node\",\n  \"Move a node to a new position in Figma\",\n  {\n    nodeId: z.string().describe(\"The ID of the node to move\"),\n    x: z.coerce.number().describe(\"New X position\"),\n    y: z.coerce.number().describe(\"New Y position\"),\n  },\n  async ({ nodeId, x, y }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"move_node\", { nodeId, x, y });\n      const typedResult = result as { name: string };\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Moved node \"${typedResult.name}\" to position (${x}, ${y})`,\n          },\n        ],\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error moving node: ${error instanceof Error ? error.message : String(error)\n              }`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Clone Node Tool\nserver.tool(\n  \"clone_node\",\n  \"Clone an existing node in Figma\",\n  {\n    nodeId: z.string().describe(\"The ID of the node to clone\"),\n    x: z.coerce.number().optional().describe(\"New X position for the clone\"),\n    y: z.coerce.number().optional().describe(\"New Y position for the clone\")\n  },\n  async ({ nodeId, x, y }: any) => {\n    try {\n      const result = await sendCommandToFigma('clone_node', { nodeId, x, y });\n      const typedResult = result as { name: string, id: string };\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Cloned node \"${typedResult.name}\" with new ID: ${typedResult.id}${x !== undefined && y !== undefined ? ` at position (${x}, ${y})` : ''}`\n          }\n        ]\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error cloning node: ${error instanceof Error ? error.message : String(error)}`\n          }\n        ]\n      };\n    }\n  }\n);\n\n// Resize Node Tool\nserver.tool(\n  \"resize_node\",\n  \"Resize a node in Figma\",\n  {\n    nodeId: z.string().describe(\"The ID of the node to resize\"),\n    width: z.coerce.number().positive().describe(\"New width\"),\n    height: z.coerce.number().positive().describe(\"New height\"),\n  },\n  async ({ nodeId, width, height }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"resize_node\", {\n        nodeId,\n        width,\n        height,\n      });\n      const typedResult = result as { name: string };\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Resized node \"${typedResult.name}\" to width ${width} and height ${height}`,\n          },\n        ],\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error resizing node: ${error instanceof Error ? error.message : String(error)\n              }`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Delete Node Tool\nserver.tool(\n  \"delete_node\",\n  \"Delete a node from Figma\",\n  {\n    nodeId: z.string().describe(\"The ID of the node to delete\"),\n  },\n  async ({ nodeId }: any) => {\n    try {\n      await sendCommandToFigma(\"delete_node\", { nodeId });\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Deleted node with ID: ${nodeId}`,\n          },\n        ],\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error deleting node: ${error instanceof Error ? error.message : String(error)\n              }`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Delete Multiple Nodes Tool\nserver.tool(\n  \"delete_multiple_nodes\",\n  \"Delete multiple nodes from Figma at once\",\n  {\n    nodeIds: flexJson(z.array(z.string())).describe(\"Array of node IDs to delete. Example: [\\\"1:2\\\",\\\"1:3\\\"]\"),\n  },\n  async ({ nodeIds }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"delete_multiple_nodes\", { nodeIds });\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: JSON.stringify(result)\n          }\n        ]\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error deleting multiple nodes: ${error instanceof Error ? error.message : String(error)\n              }`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Export Node as Image Tool\nserver.tool(\n  \"export_node_as_image\",\n  \"Export a node as an image from Figma\",\n  {\n    nodeId: z.string().describe(\"The ID of the node to export\"),\n    format: z\n      .enum([\"PNG\", \"JPG\", \"SVG\", \"PDF\"])\n      .optional()\n      .describe(\"Export format (default: PNG)\"),\n    scale: z.coerce.number().positive().optional().describe(\"Export scale (default: 1)\"),\n  },\n  async ({ nodeId, format, scale }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"export_node_as_image\", {\n        nodeId,\n        format,\n        scale,\n      });\n      const typedResult = result as { imageData: string; mimeType: string };\n\n      return {\n        content: [\n          {\n            type: \"image\",\n            data: typedResult.imageData,\n            mimeType: typedResult.mimeType || \"image/png\",\n          },\n        ],\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error exporting node as image: ${error instanceof Error ? error.message : String(error)\n              }`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Set Text Content Tool\nserver.tool(\n  \"set_text_content\",\n  \"Set the text content of an existing text node in Figma\",\n  {\n    nodeId: z.string().describe(\"The ID of the text node to modify\"),\n    text: z.string().describe(\"New text content\"),\n  },\n  async ({ nodeId, text }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"set_text_content\", {\n        nodeId,\n        text,\n      });\n      const typedResult = result as { name: string };\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Updated text content of node \"${typedResult.name}\" to \"${text}\"`,\n          },\n        ],\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error setting text content: ${error instanceof Error ? error.message : String(error)\n              }`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Get Styles Tool\nserver.tool(\n  \"get_styles\",\n  \"List local styles (paint, text, effect, grid) from the document. Returns only IDs, names, and keys (no paint/font details). Use get_style_by_id for full details on a specific style.\",\n  {},\n  async () => {\n    try {\n      const result = await sendCommandToFigma(\"get_styles\");\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: JSON.stringify(result)\n          }\n        ]\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error getting styles: ${error instanceof Error ? error.message : String(error)\n              }`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Get Local Components Tool\nserver.tool(\n  \"get_local_components\",\n  \"List local components. Use setsOnly=true to get only component sets (not individual variants). Supports pagination and name filtering. Use get_component_by_id for full details.\",\n  {\n    setsOnly: flexBool(z.boolean().optional()).describe(\"If true, return only COMPONENT_SET nodes (top-level components, not variants). Dramatically reduces results in large files.\"),\n    nameFilter: z.string().optional().describe(\"Filter components by name (case-insensitive substring match)\"),\n    limit: z.coerce.number().optional().describe(\"Max results to return (default 100)\"),\n    offset: z.coerce.number().optional().describe(\"Skip this many results for pagination (default 0)\"),\n  },\n  async ({ setsOnly, nameFilter, limit, offset }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"get_local_components\", { setsOnly, nameFilter, limit, offset });\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: JSON.stringify(result)\n          }\n        ]\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error getting local components: ${error instanceof Error ? error.message : String(error)\n              }`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Copy Instance Overrides Tool\nserver.tool(\n  \"get_instance_overrides\",\n  \"Get all override properties from a selected component instance. These overrides can be applied to other instances, which will swap them to match the source component.\",\n  {\n    nodeId: z.string().optional().describe(\"Optional ID of the component instance to get overrides from. If not provided, currently selected instance will be used.\"),\n  },\n  async ({ nodeId }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"get_instance_overrides\", {\n        instanceNodeId: nodeId || null\n      });\n      const typedResult = result as getInstanceOverridesResult;\n\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: typedResult.success\n              ? `Successfully got instance overrides: ${typedResult.message}`\n              : `Failed to get instance overrides: ${typedResult.message}`\n          }\n        ]\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error copying instance overrides: ${error instanceof Error ? error.message : String(error)}`\n          }\n        ]\n      };\n    }\n  }\n);\n\n// Set Corner Radius Tool\nserver.tool(\n  \"set_corner_radius\",\n  \"Set the corner radius of a node in Figma\",\n  {\n    nodeId: z.string().describe(\"The ID of the node to modify\"),\n    radius: z.coerce.number().min(0).describe(\"Corner radius value\"),\n    corners: flexJson(z\n      .array(flexBool(z.boolean()))\n      .length(4)\n      .optional()\n    ).describe(\n        \"Array of 4 booleans for which corners to round [topLeft, topRight, bottomRight, bottomLeft]. Example: [true,true,false,false]\"\n      ),\n  },\n  async ({ nodeId, radius, corners }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"set_corner_radius\", {\n        nodeId,\n        radius,\n        corners: corners || [true, true, true, true],\n      });\n      const typedResult = result as { name: string };\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Set corner radius of node \"${typedResult.name}\" to ${radius}px`,\n          },\n        ],\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error setting corner radius: ${error instanceof Error ? error.message : String(error)\n              }`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Define design strategy prompt\nserver.prompt(\n  \"design_strategy\",\n  \"Best practices for working with Figma designs\",\n  (extra) => {\n    return {\n      messages: [\n        {\n          role: \"assistant\",\n          content: {\n            type: \"text\",\n            text: `When working with Figma designs, follow these best practices:\n\n1. Start with Document Structure:\n   - First use get_document_info() to understand the current document\n   - Plan your layout hierarchy before creating elements\n   - Create a main container frame for each screen/section\n\n2. Naming Conventions:\n   - Use descriptive, semantic names for all elements\n   - Follow a consistent naming pattern (e.g., \"Login Screen\", \"Logo Container\", \"Email Input\")\n   - Group related elements with meaningful names\n\n3. Layout Hierarchy:\n   - Create parent frames first, then add child elements\n   - For forms/login screens:\n     * Start with the main screen container frame\n     * Create a logo container at the top\n     * Group input fields in their own containers\n     * Place action buttons (login, submit) after inputs\n     * Add secondary elements (forgot password, signup links) last\n\n4. Input Fields Structure:\n   - Create a container frame for each input field\n   - Include a label text above or inside the input\n   - Group related inputs (e.g., username/password) together\n\n5. Element Creation:\n   - Use create_frame() for containers and input fields\n   - Use create_text() for labels, buttons text, and links\n   - Set appropriate colors and styles:\n     * Use fillColor for backgrounds\n     * Use strokeColor for borders\n     * Set proper fontWeight for different text elements\n\n6. Mofifying existing elements:\n  - use set_text_content() to modify text content.\n\n7. Visual Hierarchy:\n   - Position elements in logical reading order (top to bottom)\n   - Maintain consistent spacing between elements\n   - Use appropriate font sizes for different text types:\n     * Larger for headings/welcome text\n     * Medium for input labels\n     * Standard for button text\n     * Smaller for helper text/links\n\n8. Best Practices:\n   - Verify each creation with get_node_info()\n   - Use parentId to maintain proper hierarchy\n   - Group related elements together in frames\n   - Keep consistent spacing and alignment\n\nExample Login Screen Structure:\n- Login Screen (main frame)\n  - Logo Container (frame)\n    - Logo (image/text)\n  - Welcome Text (text)\n  - Input Container (frame)\n    - Email Input (frame)\n      - Email Label (text)\n      - Email Field (frame)\n    - Password Input (frame)\n      - Password Label (text)\n      - Password Field (frame)\n  - Login Button (frame)\n    - Button Text (text)\n  - Helper Links (frame)\n    - Forgot Password (text)\n    - Don't have account (text)`,\n          },\n        },\n      ],\n      description: \"Best practices for working with Figma designs\",\n    };\n  }\n);\n\nserver.prompt(\n  \"read_design_strategy\",\n  \"Best practices for reading Figma designs\",\n  (extra) => {\n    return {\n      messages: [\n        {\n          role: \"assistant\",\n          content: {\n            type: \"text\",\n            text: `When reading Figma designs, follow these best practices:\n\n1. Start with selection:\n   - First use read_my_design() to understand the current selection\n   - If no selection ask user to select single or multiple nodes\n`,\n          },\n        },\n      ],\n      description: \"Best practices for reading Figma designs\",\n    };\n  }\n);\n\n// Text Node Scanning Tool\nserver.tool(\n  \"scan_text_nodes\",\n  \"Scan all text nodes in the selected Figma node\",\n  {\n    nodeId: z.string().describe(\"ID of the node to scan\"),\n  },\n  async ({ nodeId }: any) => {\n    try {\n      // Initial response to indicate we're starting the process\n      const initialStatus = {\n        type: \"text\" as const,\n        text: \"Starting text node scanning. This may take a moment for large designs...\",\n      };\n\n      // Use the plugin's scan_text_nodes function with chunking flag\n      const result = await sendCommandToFigma(\"scan_text_nodes\", {\n        nodeId,\n        useChunking: true,  // Enable chunking on the plugin side\n        chunkSize: 10       // Process 10 nodes at a time\n      });\n\n      // If the result indicates chunking was used, format the response accordingly\n      if (result && typeof result === 'object' && 'chunks' in result) {\n        const typedResult = result as {\n          success: boolean,\n          totalNodes: number,\n          processedNodes: number,\n          chunks: number,\n          textNodes: Array<any>\n        };\n\n        const summaryText = `\n        Scan completed:\n        - Found ${typedResult.totalNodes} text nodes\n        - Processed in ${typedResult.chunks} chunks\n        `;\n\n        return {\n          content: [\n            initialStatus,\n            {\n              type: \"text\" as const,\n              text: summaryText\n            },\n            {\n              type: \"text\" as const,\n              text: JSON.stringify(typedResult.textNodes, null, 2)\n            }\n          ],\n        };\n      }\n\n      // If chunking wasn't used or wasn't reported in the result format, return the result as is\n      return {\n        content: [\n          initialStatus,\n          {\n            type: \"text\",\n            text: JSON.stringify(result, null, 2),\n          },\n        ],\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error scanning text nodes: ${error instanceof Error ? error.message : String(error)\n              }`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Text Replacement Strategy Prompt\nserver.prompt(\n  \"text_replacement_strategy\",\n  \"Systematic approach for replacing text in Figma designs\",\n  (extra) => {\n    return {\n      messages: [\n        {\n          role: \"assistant\",\n          content: {\n            type: \"text\",\n            text: `# Intelligent Text Replacement Strategy\n\n## 1. Analyze Design & Identify Structure\n- Scan text nodes to understand the overall structure of the design\n- Use AI pattern recognition to identify logical groupings:\n  * Tables (rows, columns, headers, cells)\n  * Lists (items, headers, nested lists)\n  * Card groups (similar cards with recurring text fields)\n  * Forms (labels, input fields, validation text)\n  * Navigation (menu items, breadcrumbs)\n\\`\\`\\`\nscan_text_nodes(nodeId: \"node-id\")\nget_node_info(nodeId: \"node-id\")  // optional\n\\`\\`\\`\n\n## 2. Strategic Chunking for Complex Designs\n- Divide replacement tasks into logical content chunks based on design structure\n- Use one of these chunking strategies that best fits the design:\n  * **Structural Chunking**: Table rows/columns, list sections, card groups\n  * **Spatial Chunking**: Top-to-bottom, left-to-right in screen areas\n  * **Semantic Chunking**: Content related to the same topic or functionality\n  * **Component-Based Chunking**: Process similar component instances together\n\n## 3. Progressive Replacement with Verification\n- Create a safe copy of the node for text replacement\n- Replace text chunk by chunk with continuous progress updates\n- After each chunk is processed:\n  * Export that section as a small, manageable image\n  * Verify text fits properly and maintain design integrity\n  * Fix issues before proceeding to the next chunk\n\n\\`\\`\\`\n// Clone the node to create a safe copy\nclone_node(nodeId: \"selected-node-id\", x: [new-x], y: [new-y])\n\n// Replace text chunk by chunk\nset_multiple_text_contents(\n  nodeId: \"parent-node-id\", \n  text: [\n    { nodeId: \"node-id-1\", text: \"New text 1\" },\n    // More nodes in this chunk...\n  ]\n)\n\n// Verify chunk with small, targeted image exports\nexport_node_as_image(nodeId: \"chunk-node-id\", format: \"PNG\", scale: 0.5)\n\\`\\`\\`\n\n## 4. Intelligent Handling for Table Data\n- For tabular content:\n  * Process one row or column at a time\n  * Maintain alignment and spacing between cells\n  * Consider conditional formatting based on cell content\n  * Preserve header/data relationships\n\n## 5. Smart Text Adaptation\n- Adaptively handle text based on container constraints:\n  * Auto-detect space constraints and adjust text length\n  * Apply line breaks at appropriate linguistic points\n  * Maintain text hierarchy and emphasis\n  * Consider font scaling for critical content that must fit\n\n## 6. Progressive Feedback Loop\n- Establish a continuous feedback loop during replacement:\n  * Real-time progress updates (0-100%)\n  * Small image exports after each chunk for verification\n  * Issues identified early and resolved incrementally\n  * Quick adjustments applied to subsequent chunks\n\n## 7. Final Verification & Context-Aware QA\n- After all chunks are processed:\n  * Export the entire design at reduced scale for final verification\n  * Check for cross-chunk consistency issues\n  * Verify proper text flow between different sections\n  * Ensure design harmony across the full composition\n\n## 8. Chunk-Specific Export Scale Guidelines\n- Scale exports appropriately based on chunk size:\n  * Small chunks (1-5 elements): scale 1.0\n  * Medium chunks (6-20 elements): scale 0.7\n  * Large chunks (21-50 elements): scale 0.5\n  * Very large chunks (50+ elements): scale 0.3\n  * Full design verification: scale 0.2\n\n## Sample Chunking Strategy for Common Design Types\n\n### Tables\n- Process by logical rows (5-10 rows per chunk)\n- Alternative: Process by column for columnar analysis\n- Tip: Always include header row in first chunk for reference\n\n### Card Lists\n- Group 3-5 similar cards per chunk\n- Process entire cards to maintain internal consistency\n- Verify text-to-image ratio within cards after each chunk\n\n### Forms\n- Group related fields (e.g., \"Personal Information\", \"Payment Details\")\n- Process labels and input fields together\n- Ensure validation messages and hints are updated with their fields\n\n### Navigation & Menus\n- Process hierarchical levels together (main menu, submenu)\n- Respect information architecture relationships\n- Verify menu fit and alignment after replacement\n\n## Best Practices\n- **Preserve Design Intent**: Always prioritize design integrity\n- **Structural Consistency**: Maintain alignment, spacing, and hierarchy\n- **Visual Feedback**: Verify each chunk visually before proceeding\n- **Incremental Improvement**: Learn from each chunk to improve subsequent ones\n- **Balance Automation & Control**: Let AI handle repetitive replacements but maintain oversight\n- **Respect Content Relationships**: Keep related content consistent across chunks\n\nRemember that text is never just text—it's a core design element that must work harmoniously with the overall composition. This chunk-based strategy allows you to methodically transform text while maintaining design integrity.`,\n          },\n        },\n      ],\n      description: \"Systematic approach for replacing text in Figma designs\",\n    };\n  }\n);\n\n// Set Multiple Text Contents Tool\nserver.tool(\n  \"set_multiple_text_contents\",\n  \"Set multiple text contents parallelly in a node\",\n  {\n    nodeId: z\n      .string()\n      .describe(\"The ID of the node containing the text nodes to replace\"),\n    text: flexJson(z\n      .array(\n        z.object({\n          nodeId: z.string().describe(\"The ID of the text node\"),\n          text: z.string().describe(\"The replacement text\"),\n        })\n      )\n    ).describe(\"Array of {nodeId, text} pairs. Example: [{\\\"nodeId\\\":\\\"1:2\\\",\\\"text\\\":\\\"Hello\\\"}]\"),\n  },\n  async ({ nodeId, text }: any) => {\n    try {\n      if (!text || text.length === 0) {\n        return {\n          content: [\n            {\n              type: \"text\",\n              text: \"No text provided\",\n            },\n          ],\n        };\n      }\n\n      // Initial response to indicate we're starting the process\n      const initialStatus = {\n        type: \"text\" as const,\n        text: `Starting text replacement for ${text.length} nodes. This will be processed in batches of 5...`,\n      };\n\n      // Track overall progress\n      let totalProcessed = 0;\n      const totalToProcess = text.length;\n\n      // Use the plugin's set_multiple_text_contents function with chunking\n      const result = await sendCommandToFigma(\"set_multiple_text_contents\", {\n        nodeId,\n        text,\n      });\n\n      // Cast the result to a specific type to work with it safely\n      interface TextReplaceResult {\n        success: boolean;\n        nodeId: string;\n        replacementsApplied?: number;\n        replacementsFailed?: number;\n        totalReplacements?: number;\n        completedInChunks?: number;\n        results?: Array<{\n          success: boolean;\n          nodeId: string;\n          error?: string;\n          originalText?: string;\n          translatedText?: string;\n        }>;\n      }\n\n      const typedResult = result as TextReplaceResult;\n\n      // Format the results for display\n      const success = typedResult.replacementsApplied && typedResult.replacementsApplied > 0;\n      const progressText = `\n      Text replacement completed:\n      - ${typedResult.replacementsApplied || 0} of ${totalToProcess} successfully updated\n      - ${typedResult.replacementsFailed || 0} failed\n      - Processed in ${typedResult.completedInChunks || 1} batches\n      `;\n\n      // Detailed results\n      const detailedResults = typedResult.results || [];\n      const failedResults = detailedResults.filter(item => !item.success);\n\n      // Create the detailed part of the response\n      let detailedResponse = \"\";\n      if (failedResults.length > 0) {\n        detailedResponse = `\\n\\nNodes that failed:\\n${failedResults.map(item =>\n          `- ${item.nodeId}: ${item.error || \"Unknown error\"}`\n        ).join('\\n')}`;\n      }\n\n      return {\n        content: [\n          initialStatus,\n          {\n            type: \"text\" as const,\n            text: progressText + detailedResponse,\n          },\n        ],\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error setting multiple text contents: ${error instanceof Error ? error.message : String(error)\n              }`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Annotation Conversion Strategy Prompt\nserver.prompt(\n  \"annotation_conversion_strategy\",\n  \"Strategy for converting manual annotations to Figma's native annotations\",\n  (extra) => {\n    return {\n      messages: [\n        {\n          role: \"assistant\",\n          content: {\n            type: \"text\",\n            text: `# Automatic Annotation Conversion\n            \n## Process Overview\n\nThe process of converting manual annotations (numbered/alphabetical indicators with connected descriptions) to Figma's native annotations:\n\n1. Get selected frame/component information\n2. Scan and collect all annotation text nodes\n3. Scan target UI elements (components, instances, frames)\n4. Match annotations to appropriate UI elements\n5. Apply native Figma annotations\n\n## Step 1: Get Selection and Initial Setup\n\nFirst, get the selected frame or component that contains annotations:\n\n\\`\\`\\`typescript\n// Get the selected frame/component\nconst selection = await get_selection();\nconst selectedNodeId = selection[0].id\n\n// Get available annotation categories for later use\nconst annotationData = await get_annotations({\n  nodeId: selectedNodeId,\n  includeCategories: true\n});\nconst categories = annotationData.categories;\n\\`\\`\\`\n\n## Step 2: Scan Annotation Text Nodes\n\nScan all text nodes to identify annotations and their descriptions:\n\n\\`\\`\\`typescript\n// Get all text nodes in the selection\nconst textNodes = await scan_text_nodes({\n  nodeId: selectedNodeId\n});\n\n// Filter and group annotation markers and descriptions\n\n// Markers typically have these characteristics:\n// - Short text content (usually single digit/letter)\n// - Specific font styles (often bold)\n// - Located in a container with \"Marker\" or \"Dot\" in the name\n// - Have a clear naming pattern (e.g., \"1\", \"2\", \"3\" or \"A\", \"B\", \"C\")\n\n\n// Identify description nodes\n// Usually longer text nodes near markers or with matching numbers in path\n  \n\\`\\`\\`\n\n## Step 3: Scan Target UI Elements\n\nGet all potential target elements that annotations might refer to:\n\n\\`\\`\\`typescript\n// Scan for all UI elements that could be annotation targets\nconst targetNodes = await scan_nodes_by_types({\n  nodeId: selectedNodeId,\n  types: [\n    \"COMPONENT\",\n    \"INSTANCE\",\n    \"FRAME\"\n  ]\n});\n\\`\\`\\`\n\n## Step 4: Match Annotations to Targets\n\nMatch each annotation to its target UI element using these strategies in order of priority:\n\n1. **Path-Based Matching**:\n   - Look at the marker's parent container name in the Figma layer hierarchy\n   - Remove any \"Marker:\" or \"Annotation:\" prefixes from the parent name\n   - Find UI elements that share the same parent name or have it in their path\n   - This works well when markers are grouped with their target elements\n\n2. **Name-Based Matching**:\n   - Extract key terms from the annotation description\n   - Look for UI elements whose names contain these key terms\n   - Consider both exact matches and semantic similarities\n   - Particularly effective for form fields, buttons, and labeled components\n\n3. **Proximity-Based Matching** (fallback):\n   - Calculate the center point of the marker\n   - Find the closest UI element by measuring distances to element centers\n   - Consider the marker's position relative to nearby elements\n   - Use this method when other matching strategies fail\n\nAdditional Matching Considerations:\n- Give higher priority to matches found through path-based matching\n- Consider the type of UI element when evaluating matches\n- Take into account the annotation's context and content\n- Use a combination of strategies for more accurate matching\n\n## Step 5: Apply Native Annotations\n\nConvert matched annotations to Figma's native annotations using batch processing:\n\n\\`\\`\\`typescript\n// Prepare annotations array for batch processing\nconst annotationsToApply = Object.values(annotations).map(({ marker, description }) => {\n  // Find target using multiple strategies\n  const target = \n    findTargetByPath(marker, targetNodes) ||\n    findTargetByName(description, targetNodes) ||\n    findTargetByProximity(marker, targetNodes);\n  \n  if (target) {\n    // Determine appropriate category based on content\n    const category = determineCategory(description.characters, categories);\n\n    // Determine appropriate additional annotationProperty based on content\n    const annotationProperty = determineProperties(description.characters, target.type);\n    \n    return {\n      nodeId: target.id,\n      labelMarkdown: description.characters,\n      categoryId: category.id,\n      properties: annotationProperty\n    };\n  }\n  return null;\n}).filter(Boolean); // Remove null entries\n\n// Apply annotations in batches using set_multiple_annotations\nif (annotationsToApply.length > 0) {\n  await set_multiple_annotations({\n    nodeId: selectedNodeId,\n    annotations: annotationsToApply\n  });\n}\n\\`\\`\\`\n\n\nThis strategy focuses on practical implementation based on real-world usage patterns, emphasizing the importance of handling various UI elements as annotation targets, not just text nodes.`\n          },\n        },\n      ],\n      description: \"Strategy for converting manual annotations to Figma's native annotations\",\n    };\n  }\n);\n\n// Instance Slot Filling Strategy Prompt\nserver.prompt(\n  \"swap_overrides_instances\",\n  \"Guide to swap instance overrides between instances\",\n  (extra) => {\n    return {\n      messages: [\n        {\n          role: \"assistant\",\n          content: {\n            type: \"text\",\n            text: `# Swap Component Instance and Override Strategy\n\n## Overview\nThis strategy enables transferring content and property overrides from a source instance to one or more target instances in Figma, maintaining design consistency while reducing manual work.\n\n## Step-by-Step Process\n\n### 1. Selection Analysis\n- Use \\`get_selection()\\` to identify the parent component or selected instances\n- For parent components, scan for instances with \\`scan_nodes_by_types({ nodeId: \"parent-id\", types: [\"INSTANCE\"] })\\`\n- Identify custom slots by name patterns (e.g. \"Custom Slot*\" or \"Instance Slot\") or by examining text content\n- Determine which is the source instance (with content to copy) and which are targets (where to apply content)\n\n### 2. Extract Source Overrides\n- Use \\`get_instance_overrides()\\` to extract customizations from the source instance\n- This captures text content, property values, and style overrides\n- Command syntax: \\`get_instance_overrides({ nodeId: \"source-instance-id\" })\\`\n- Look for successful response like \"Got component information from [instance name]\"\n\n### 3. Apply Overrides to Targets\n- Apply captured overrides using \\`set_instance_overrides()\\`\n- Command syntax:\n  \\`\\`\\`\n  set_instance_overrides({\n    sourceInstanceId: \"source-instance-id\", \n    targetNodeIds: [\"target-id-1\", \"target-id-2\", ...]\n  })\n  \\`\\`\\`\n\n### 4. Verification\n- Verify results with \\`get_node_info()\\` or \\`read_my_design()\\`\n- Confirm text content and style overrides have transferred successfully\n\n## Key Tips\n- Always join the appropriate channel first with \\`join_channel()\\`\n- When working with multiple targets, check the full selection with \\`get_selection()\\`\n- Preserve component relationships by using instance overrides rather than direct text manipulation`,\n          },\n        },\n      ],\n      description: \"Strategy for transferring overrides between component instances in Figma\",\n    };\n  }\n);\n\n// Set Layout Mode Tool\nserver.tool(\n  \"set_layout_mode\",\n  \"Set the layout mode and wrap behavior of a frame in Figma\",\n  {\n    nodeId: z.string().describe(\"The ID of the frame to modify\"),\n    layoutMode: z.enum([\"NONE\", \"HORIZONTAL\", \"VERTICAL\"]).describe(\"Layout mode for the frame\"),\n    layoutWrap: z.enum([\"NO_WRAP\", \"WRAP\"]).optional().describe(\"Wrap behavior (default: NO_WRAP)\")\n  },\n  async ({ nodeId, layoutMode, layoutWrap }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"set_layout_mode\", {\n        nodeId,\n        layoutMode,\n        layoutWrap,\n      });\n      const typedResult = result as { name: string };\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Set layout mode of frame \"${typedResult.name}\" to ${layoutMode}${layoutWrap ? ` with ${layoutWrap}` : ''}`,\n          },\n        ],\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error setting layout mode: ${error instanceof Error ? error.message : String(error)}`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Set Padding Tool\nserver.tool(\n  \"set_padding\",\n  \"Set padding values for an auto-layout frame in Figma\",\n  {\n    nodeId: z.string().describe(\"The ID of the frame to modify\"),\n    paddingTop: z.coerce.number().optional().describe(\"Top padding value\"),\n    paddingRight: z.coerce.number().optional().describe(\"Right padding value\"),\n    paddingBottom: z.coerce.number().optional().describe(\"Bottom padding value\"),\n    paddingLeft: z.coerce.number().optional().describe(\"Left padding value\"),\n  },\n  async ({ nodeId, paddingTop, paddingRight, paddingBottom, paddingLeft }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"set_padding\", {\n        nodeId,\n        paddingTop,\n        paddingRight,\n        paddingBottom,\n        paddingLeft,\n      });\n      const typedResult = result as { name: string };\n\n      // Create a message about which padding values were set\n      const paddingMessages = [];\n      if (paddingTop !== undefined) paddingMessages.push(`top: ${paddingTop}`);\n      if (paddingRight !== undefined) paddingMessages.push(`right: ${paddingRight}`);\n      if (paddingBottom !== undefined) paddingMessages.push(`bottom: ${paddingBottom}`);\n      if (paddingLeft !== undefined) paddingMessages.push(`left: ${paddingLeft}`);\n\n      const paddingText = paddingMessages.length > 0\n        ? `padding (${paddingMessages.join(', ')})`\n        : \"padding\";\n\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Set ${paddingText} for frame \"${typedResult.name}\"`,\n          },\n        ],\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error setting padding: ${error instanceof Error ? error.message : String(error)}`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Set Axis Align Tool\nserver.tool(\n  \"set_axis_align\",\n  \"Set primary and counter axis alignment for an auto-layout frame in Figma\",\n  {\n    nodeId: z.string().describe(\"The ID of the frame to modify\"),\n    primaryAxisAlignItems: z\n      .enum([\"MIN\", \"MAX\", \"CENTER\", \"SPACE_BETWEEN\"])\n      .optional()\n      .describe(\"Primary axis alignment (MIN/MAX = left/right in horizontal, top/bottom in vertical). Note: When set to SPACE_BETWEEN, itemSpacing will be ignored as children will be evenly spaced.\"),\n    counterAxisAlignItems: z\n      .enum([\"MIN\", \"MAX\", \"CENTER\", \"BASELINE\"])\n      .optional()\n      .describe(\"Counter axis alignment (MIN/MAX = top/bottom in horizontal, left/right in vertical)\")\n  },\n  async ({ nodeId, primaryAxisAlignItems, counterAxisAlignItems }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"set_axis_align\", {\n        nodeId,\n        primaryAxisAlignItems,\n        counterAxisAlignItems\n      });\n      const typedResult = result as { name: string };\n\n      // Create a message about which alignments were set\n      const alignMessages = [];\n      if (primaryAxisAlignItems !== undefined) alignMessages.push(`primary: ${primaryAxisAlignItems}`);\n      if (counterAxisAlignItems !== undefined) alignMessages.push(`counter: ${counterAxisAlignItems}`);\n\n      const alignText = alignMessages.length > 0\n        ? `axis alignment (${alignMessages.join(', ')})`\n        : \"axis alignment\";\n\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Set ${alignText} for frame \"${typedResult.name}\"`,\n          },\n        ],\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error setting axis alignment: ${error instanceof Error ? error.message : String(error)}`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Set Layout Sizing Tool\nserver.tool(\n  \"set_layout_sizing\",\n  \"Set horizontal and vertical sizing modes for auto-layout containers (frames, components, instances) or their children (including TEXT nodes)\",\n  {\n    nodeId: z.string().describe(\"The ID of the node to modify\"),\n    layoutSizingHorizontal: z\n      .enum([\"FIXED\", \"HUG\", \"FILL\"])\n      .optional()\n      .describe(\"Horizontal sizing mode (HUG for frames/text only, FILL for auto-layout children only)\"),\n    layoutSizingVertical: z\n      .enum([\"FIXED\", \"HUG\", \"FILL\"])\n      .optional()\n      .describe(\"Vertical sizing mode (HUG for frames/text only, FILL for auto-layout children only)\")\n  },\n  async ({ nodeId, layoutSizingHorizontal, layoutSizingVertical }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"set_layout_sizing\", {\n        nodeId,\n        layoutSizingHorizontal,\n        layoutSizingVertical\n      });\n      const typedResult = result as { name: string };\n\n      // Create a message about which sizing modes were set\n      const sizingMessages = [];\n      if (layoutSizingHorizontal !== undefined) sizingMessages.push(`horizontal: ${layoutSizingHorizontal}`);\n      if (layoutSizingVertical !== undefined) sizingMessages.push(`vertical: ${layoutSizingVertical}`);\n\n      const sizingText = sizingMessages.length > 0\n        ? `layout sizing (${sizingMessages.join(', ')})`\n        : \"layout sizing\";\n\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Set ${sizingText} for frame \"${typedResult.name}\"`,\n          },\n        ],\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error setting layout sizing: ${error instanceof Error ? error.message : String(error)}`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Set Item Spacing Tool\nserver.tool(\n  \"set_item_spacing\",\n  \"Set distance between children in an auto-layout frame. Provide at least one of itemSpacing or counterAxisSpacing.\",\n  {\n    nodeId: z.string().describe(\"The ID of the frame to modify\"),\n    itemSpacing: z.coerce.number().optional().describe(\"Distance between children. Note: This value will be ignored if primaryAxisAlignItems is set to SPACE_BETWEEN.\"),\n    counterAxisSpacing: z.coerce.number().optional().describe(\"Distance between wrapped rows/columns. Only works when layoutWrap is set to WRAP.\")\n  },\n  async ({ nodeId, itemSpacing, counterAxisSpacing}: any) => {\n    try {\n      const params: any = { nodeId };\n      if (itemSpacing !== undefined) params.itemSpacing = itemSpacing;\n      if (counterAxisSpacing !== undefined) params.counterAxisSpacing = counterAxisSpacing;\n      \n      const result = await sendCommandToFigma(\"set_item_spacing\", params);\n      const typedResult = result as { name: string, itemSpacing?: number, counterAxisSpacing?: number };\n\n      let message = `Updated spacing for frame \"${typedResult.name}\":`;\n      if (itemSpacing !== undefined) message += ` itemSpacing=${itemSpacing}`;\n      if (counterAxisSpacing !== undefined) message += ` counterAxisSpacing=${counterAxisSpacing}`;\n\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: message,\n          },\n        ],\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error setting spacing: ${error instanceof Error ? error.message : String(error)}`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Set Focus Tool\nserver.tool(\n  \"set_focus\",\n  \"Set focus on a specific node in Figma by selecting it and scrolling viewport to it\",\n  {\n    nodeId: z.string().describe(\"The ID of the node to focus on\"),\n  },\n  async ({ nodeId }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"set_focus\", { nodeId });\n      const typedResult = result as { name: string; id: string };\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Focused on node \"${typedResult.name}\" (ID: ${typedResult.id})`,\n          },\n        ],\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error setting focus: ${error instanceof Error ? error.message : String(error)}`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Set Selections Tool\nserver.tool(\n  \"set_selections\",\n  \"Set selection to multiple nodes in Figma and scroll viewport to show them\",\n  {\n    nodeIds: flexJson(z.array(z.string())).describe(\"Array of node IDs to select. Example: [\\\"1:2\\\",\\\"1:3\\\"]\"),\n  },\n  async ({ nodeIds }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"set_selections\", { nodeIds });\n      const typedResult = result as { selectedNodes: Array<{ name: string; id: string }>; count: number };\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Selected ${typedResult.count} nodes: ${typedResult.selectedNodes.map(node => `\"${node.name}\" (${node.id})`).join(', ')}`,\n          },\n        ],\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error setting selections: ${error instanceof Error ? error.message : String(error)}`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Define command types and parameters\ntype FigmaCommand =\n  | \"get_document_info\"\n  | \"get_selection\"\n  | \"get_node_info\"\n  | \"get_nodes_info\"\n  | \"read_my_design\"\n  | \"create_rectangle\"\n  | \"create_frame\"\n  | \"create_text\"\n  | \"set_fill_color\"\n  | \"set_stroke_color\"\n  | \"move_node\"\n  | \"resize_node\"\n  | \"delete_node\"\n  | \"delete_multiple_nodes\"\n  | \"get_styles\"\n  | \"get_local_components\"\n  | \"get_instance_overrides\"\n  | \"export_node_as_image\"\n  | \"join\"\n  | \"set_corner_radius\"\n  | \"clone_node\"\n  | \"set_text_content\"\n  | \"scan_text_nodes\"\n  | \"set_multiple_text_contents\"\n  | \"set_layout_mode\"\n  | \"set_padding\"\n  | \"set_axis_align\"\n  | \"set_layout_sizing\"\n  | \"set_item_spacing\"\n  | \"set_focus\"\n  | \"set_selections\"\n  | \"create_component\"\n  | \"create_component_from_node\"\n  | \"combine_as_variants\"\n  | \"add_component_property\"\n  | \"create_instance_from_local\"\n  | \"create_variable_collection\"\n  | \"create_variable\"\n  | \"set_variable_value\"\n  | \"get_local_variables\"\n  | \"get_local_variable_collections\"\n  | \"set_variable_binding\"\n  | \"create_paint_style\"\n  | \"create_text_style\"\n  | \"create_effect_style\"\n  | \"apply_style_to_node\"\n  | \"create_ellipse\"\n  | \"create_line\"\n  | \"create_boolean_operation\"\n  | \"set_opacity\"\n  | \"set_effects\"\n  | \"set_constraints\"\n  | \"set_export_settings\"\n  | \"set_node_properties\"\n  | \"get_style_by_id\"\n  | \"remove_style\"\n  | \"get_component_by_id\"\n  | \"get_variable_by_id\"\n  | \"get_variable_collection_by_id\"\n  | \"get_pages\"\n  | \"set_current_page\"\n  | \"create_page\"\n  | \"get_node_css\"\n  | \"get_available_fonts\"\n  | \"create_section\"\n  | \"insert_child\"\n  | \"create_node_from_svg\"\n  | \"get_current_page\"\n  | \"search_nodes\"\n  | \"add_mode\"\n  | \"rename_mode\"\n  | \"remove_mode\"\n  | \"rename_page\"\n  | \"zoom_into_view\"\n  | \"set_viewport\"\n  | \"create_auto_layout\";\n\ntype CommandParams = {\n  get_document_info: { depth?: number };\n  get_selection: Record<string, never>;\n  get_node_info: { nodeId: string; depth?: number };\n  get_nodes_info: { nodeIds: string[]; depth?: number };\n  read_my_design: { depth?: number };\n  create_rectangle: {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    name?: string;\n    parentId?: string;\n  };\n  create_frame: {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    name?: string;\n    parentId?: string;\n    fillColor?: { r: number; g: number; b: number; a?: number };\n    strokeColor?: { r: number; g: number; b: number; a?: number };\n    strokeWeight?: number;\n  };\n  create_text: {\n    x: number;\n    y: number;\n    text: string;\n    fontSize?: number;\n    fontWeight?: number;\n    fontColor?: { r: number; g: number; b: number; a?: number };\n    name?: string;\n    parentId?: string;\n    textStyleId?: string;\n    layoutSizingHorizontal?: string;\n    layoutSizingVertical?: string;\n    textAutoResize?: string;\n  };\n  set_fill_color: {\n    nodeId: string;\n    r: number;\n    g: number;\n    b: number;\n    a?: number;\n  };\n  set_stroke_color: {\n    nodeId: string;\n    r: number;\n    g: number;\n    b: number;\n    a?: number;\n    weight?: number;\n  };\n  move_node: {\n    nodeId: string;\n    x: number;\n    y: number;\n  };\n  resize_node: {\n    nodeId: string;\n    width: number;\n    height: number;\n  };\n  delete_node: {\n    nodeId: string;\n  };\n  delete_multiple_nodes: {\n    nodeIds: string[];\n  };\n  get_styles: Record<string, never>;\n  get_local_components: {\n    setsOnly?: boolean;\n    nameFilter?: string;\n    limit?: number;\n    offset?: number;\n  };\n  get_team_components: Record<string, never>;\n  get_instance_overrides: {\n    instanceNodeId: string | null;\n  };\n  export_node_as_image: {\n    nodeId: string;\n    format?: \"PNG\" | \"JPG\" | \"SVG\" | \"PDF\";\n    scale?: number;\n  };\n  execute_code: {\n    code: string;\n  };\n  join: {\n    channel: string;\n  };\n  set_corner_radius: {\n    nodeId: string;\n    radius: number;\n    corners?: boolean[];\n  };\n  clone_node: {\n    nodeId: string;\n    x?: number;\n    y?: number;\n  };\n  set_text_content: {\n    nodeId: string;\n    text: string;\n  };\n  scan_text_nodes: {\n    nodeId: string;\n    useChunking: boolean;\n    chunkSize: number;\n  };\n  set_multiple_text_contents: {\n    nodeId: string;\n    text: Array<{ nodeId: string; text: string }>;\n  };\n  set_focus: {\n    nodeId: string;\n  };\n  set_selections: {\n    nodeIds: string[];\n  };\n\n  create_component: {\n    name: string;\n    x?: number;\n    y?: number;\n    width?: number;\n    height?: number;\n    parentId?: string;\n    fillColor?: { r: number; g: number; b: number; a?: number };\n    strokeColor?: { r: number; g: number; b: number; a?: number };\n    strokeWeight?: number;\n    cornerRadius?: number;\n    layoutMode?: \"NONE\" | \"HORIZONTAL\" | \"VERTICAL\";\n    layoutWrap?: \"NO_WRAP\" | \"WRAP\";\n    paddingTop?: number;\n    paddingRight?: number;\n    paddingBottom?: number;\n    paddingLeft?: number;\n    primaryAxisAlignItems?: \"MIN\" | \"MAX\" | \"CENTER\" | \"SPACE_BETWEEN\";\n    counterAxisAlignItems?: \"MIN\" | \"MAX\" | \"CENTER\" | \"BASELINE\";\n    layoutSizingHorizontal?: \"FIXED\" | \"HUG\" | \"FILL\";\n    layoutSizingVertical?: \"FIXED\" | \"HUG\" | \"FILL\";\n    itemSpacing?: number;\n  };\n  create_component_from_node: {\n    nodeId: string;\n  };\n  combine_as_variants: {\n    componentIds: string[];\n    name?: string;\n  };\n  add_component_property: {\n    componentId: string;\n    propertyName: string;\n    type: \"BOOLEAN\" | \"TEXT\" | \"INSTANCE_SWAP\" | \"VARIANT\";\n    defaultValue: string | boolean;\n    preferredValues?: Array<{ type: \"COMPONENT\" | \"COMPONENT_SET\"; key: string }>;\n  };\n  create_instance_from_local: {\n    componentId: string;\n    x?: number;\n    y?: number;\n    parentId?: string;\n  };\n  create_variable_collection: {\n    name: string;\n  };\n  create_variable: {\n    collectionId: string;\n    name: string;\n    resolvedType: \"COLOR\" | \"FLOAT\" | \"STRING\" | \"BOOLEAN\";\n  };\n  set_variable_value: {\n    variableId: string;\n    modeId: string;\n    value: number | string | boolean | { r: number; g: number; b: number; a?: number };\n  };\n  get_local_variables: {\n    type?: \"COLOR\" | \"FLOAT\" | \"STRING\" | \"BOOLEAN\";\n    collectionId?: string;\n  };\n  get_local_variable_collections: Record<string, never>;\n  set_variable_binding: {\n    nodeId: string;\n    field: string;\n    variableId: string;\n  };\n  create_paint_style: {\n    name: string;\n    color: { r: number; g: number; b: number; a?: number };\n  };\n  create_text_style: {\n    name: string;\n    fontFamily: string;\n    fontStyle?: string;\n    fontSize: number;\n    lineHeight?: number | { value: number; unit: \"PIXELS\" | \"PERCENT\" | \"AUTO\" };\n    letterSpacing?: number | { value: number; unit: \"PIXELS\" | \"PERCENT\" };\n    textCase?: \"ORIGINAL\" | \"UPPER\" | \"LOWER\" | \"TITLE\";\n    textDecoration?: \"NONE\" | \"UNDERLINE\" | \"STRIKETHROUGH\";\n  };\n  create_effect_style: {\n    name: string;\n    effects: Array<{\n      type: \"DROP_SHADOW\" | \"INNER_SHADOW\" | \"LAYER_BLUR\" | \"BACKGROUND_BLUR\";\n      color?: { r: number; g: number; b: number; a?: number };\n      offset?: { x: number; y: number };\n      radius: number;\n      spread?: number;\n      visible?: boolean;\n    }>;\n  };\n  apply_style_to_node: {\n    nodeId: string;\n    styleId?: string;\n    styleName?: string;\n    styleType: \"fill\" | \"stroke\" | \"text\" | \"effect\";\n  };\n  create_ellipse: {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    name?: string;\n    parentId?: string;\n  };\n  create_line: {\n    x: number;\n    y: number;\n    length: number;\n    rotation?: number;\n    name?: string;\n    parentId?: string;\n  };\n  create_boolean_operation: {\n    nodeIds: string[];\n    operation: \"UNION\" | \"INTERSECT\" | \"SUBTRACT\" | \"EXCLUDE\";\n    name?: string;\n  };\n  set_opacity: {\n    nodeId: string;\n    opacity: number;\n  };\n  set_effects: {\n    nodeId: string;\n    effects: Array<{\n      type: \"DROP_SHADOW\" | \"INNER_SHADOW\" | \"LAYER_BLUR\" | \"BACKGROUND_BLUR\";\n      color?: { r: number; g: number; b: number; a?: number };\n      offset?: { x: number; y: number };\n      radius: number;\n      spread?: number;\n      visible?: boolean;\n    }>;\n  };\n  set_constraints: {\n    nodeId: string;\n    horizontal: \"MIN\" | \"CENTER\" | \"MAX\" | \"STRETCH\" | \"SCALE\";\n    vertical: \"MIN\" | \"CENTER\" | \"MAX\" | \"STRETCH\" | \"SCALE\";\n  };\n  set_export_settings: {\n    nodeId: string;\n    settings: Array<{\n      format: \"PNG\" | \"JPG\" | \"SVG\" | \"PDF\";\n      suffix?: string;\n      contentsOnly?: boolean;\n      constraint?: { type: \"SCALE\" | \"WIDTH\" | \"HEIGHT\"; value: number };\n    }>;\n  };\n  set_node_properties: {\n    nodeId: string;\n    properties: Record<string, unknown>;\n  };\n  get_style_by_id: {\n    styleId: string;\n  };\n  remove_style: {\n    styleId: string;\n  };\n  get_component_by_id: {\n    componentId: string;\n    includeChildren?: boolean;\n  };\n  get_variable_by_id: {\n    variableId: string;\n  };\n  get_variable_collection_by_id: {\n    collectionId: string;\n  };\n  get_pages: Record<string, never>;\n  set_current_page: {\n    pageId?: string;\n    pageName?: string;\n  };\n  create_page: {\n    name?: string;\n  };\n  get_node_css: {\n    nodeId: string;\n  };\n  get_available_fonts: {\n    query?: string;\n  };\n  create_section: {\n    x?: number;\n    y?: number;\n    width?: number;\n    height?: number;\n    name?: string;\n    parentId?: string;\n  };\n  insert_child: {\n    parentId: string;\n    childId: string;\n    index?: number;\n  };\n  create_node_from_svg: {\n    svg: string;\n    x?: number;\n    y?: number;\n    name?: string;\n    parentId?: string;\n  };\n  get_current_page: Record<string, never>;\n  search_nodes: {\n    query?: string;\n    types?: string[];\n    scopeNodeId?: string;\n    caseSensitive?: boolean;\n    limit?: number;\n    offset?: number;\n  };\n  add_mode: {\n    collectionId: string;\n    name: string;\n  };\n  rename_mode: {\n    collectionId: string;\n    modeId: string;\n    name: string;\n  };\n  remove_mode: {\n    collectionId: string;\n    modeId: string;\n  };\n  rename_page: {\n    newName: string;\n    pageId?: string;\n  };\n  zoom_into_view: {\n    nodeIds: string[];\n  };\n  set_viewport: {\n    center?: { x: number; y: number };\n    zoom?: number;\n  };\n  create_auto_layout: {\n    nodeIds: string[];\n    name?: string;\n    layoutMode?: \"HORIZONTAL\" | \"VERTICAL\";\n    itemSpacing?: number;\n    paddingTop?: number;\n    paddingRight?: number;\n    paddingBottom?: number;\n    paddingLeft?: number;\n    primaryAxisAlignItems?: \"MIN\" | \"MAX\" | \"CENTER\" | \"SPACE_BETWEEN\";\n    counterAxisAlignItems?: \"MIN\" | \"MAX\" | \"CENTER\" | \"BASELINE\";\n    layoutSizingHorizontal?: \"FIXED\" | \"HUG\" | \"FILL\";\n    layoutSizingVertical?: \"FIXED\" | \"HUG\" | \"FILL\";\n    layoutWrap?: \"NO_WRAP\" | \"WRAP\";\n  };\n};\n\n\n// Helper function to process Figma node responses\nfunction processFigmaNodeResponse(result: unknown): any {\n  if (!result || typeof result !== \"object\") {\n    return result;\n  }\n\n  // Check if this looks like a node response\n  const resultObj = result as Record<string, unknown>;\n  if (\"id\" in resultObj && typeof resultObj.id === \"string\") {\n    // It appears to be a node response, log the details\n    console.info(\n      `Processed Figma node: ${resultObj.name || \"Unknown\"} (ID: ${resultObj.id\n      })`\n    );\n\n    if (\"x\" in resultObj && \"y\" in resultObj) {\n      console.debug(`Node position: (${resultObj.x}, ${resultObj.y})`);\n    }\n\n    if (\"width\" in resultObj && \"height\" in resultObj) {\n      console.debug(`Node dimensions: ${resultObj.width}×${resultObj.height}`);\n    }\n  }\n\n  return result;\n}\n\n// Update the connectToFigma function\nfunction connectToFigma(port: number = 3055) {\n  // If already connected, do nothing\n  if (ws && ws.readyState === WebSocket.OPEN) {\n    logger.info('Already connected to Figma');\n    return;\n  }\n\n  const wsUrl = serverUrl === 'localhost' ? `${WS_URL}:${port}` : WS_URL;\n  logger.info(`Connecting to Figma socket server at ${wsUrl}...`);\n  ws = new WebSocket(wsUrl);\n\n  ws.on('open', () => {\n    logger.info('Connected to Figma socket server');\n    // Reset channel on new connection\n    currentChannel = null;\n  });\n\n  ws.on(\"message\", (data: any) => {\n    try {\n      // Define a more specific type with an index signature to allow any property access\n      interface ProgressMessage {\n        message: FigmaResponse | any;\n        type?: string;\n        id?: string;\n        [key: string]: any; // Allow any other properties\n      }\n\n      const json = JSON.parse(data) as ProgressMessage;\n\n      // Handle progress updates\n      if (json.type === 'progress_update') {\n        const progressData = json.message.data as CommandProgressUpdate;\n        const requestId = json.id || '';\n\n        if (requestId && pendingRequests.has(requestId)) {\n          const request = pendingRequests.get(requestId)!;\n\n          // Update last activity timestamp\n          request.lastActivity = Date.now();\n\n          // Reset the timeout to prevent timeouts during long-running operations\n          clearTimeout(request.timeout);\n\n          // Create a new timeout\n          request.timeout = setTimeout(() => {\n            if (pendingRequests.has(requestId)) {\n              logger.error(`Request ${requestId} timed out after extended period of inactivity`);\n              pendingRequests.delete(requestId);\n              request.reject(new Error('Request to Figma timed out'));\n            }\n          }, 60000); // 60 second timeout for inactivity\n\n          // Log progress\n          logger.info(`Progress update for ${progressData.commandType}: ${progressData.progress}% - ${progressData.message}`);\n\n          // For completed updates, we could resolve the request early if desired\n          if (progressData.status === 'completed' && progressData.progress === 100) {\n            // Optionally resolve early with partial data\n            // request.resolve(progressData.payload);\n            // pendingRequests.delete(requestId);\n\n            // Instead, just log the completion, wait for final result from Figma\n            logger.info(`Operation ${progressData.commandType} completed, waiting for final result`);\n          }\n        }\n        return;\n      }\n\n      // Handle regular responses\n      const myResponse = json.message;\n      logger.debug(`Received message: ${JSON.stringify(myResponse)}`);\n      logger.log('myResponse' + JSON.stringify(myResponse));\n\n      // Handle response to a request\n      if (\n        myResponse.id &&\n        pendingRequests.has(myResponse.id) &&\n        myResponse.result\n      ) {\n        const request = pendingRequests.get(myResponse.id)!;\n        clearTimeout(request.timeout);\n\n        if (myResponse.error) {\n          logger.error(`Error from Figma: ${myResponse.error}`);\n          request.reject(new Error(myResponse.error));\n        } else {\n          if (myResponse.result) {\n            request.resolve(myResponse.result);\n          }\n        }\n\n        pendingRequests.delete(myResponse.id);\n      } else {\n        // Handle broadcast messages or events\n        logger.info(`Received broadcast message: ${JSON.stringify(myResponse)}`);\n      }\n    } catch (error) {\n      logger.error(`Error parsing message: ${error instanceof Error ? error.message : String(error)}`);\n    }\n  });\n\n  ws.on('error', (error) => {\n    logger.error(`Socket error: ${error}`);\n  });\n\n  ws.on('close', () => {\n    logger.info('Disconnected from Figma socket server');\n    ws = null;\n\n    // Reject all pending requests\n    for (const [id, request] of pendingRequests.entries()) {\n      clearTimeout(request.timeout);\n      request.reject(new Error(\"Connection closed\"));\n      pendingRequests.delete(id);\n    }\n\n    // Attempt to reconnect\n    logger.info('Attempting to reconnect in 2 seconds...');\n    setTimeout(() => connectToFigma(port), 2000);\n  });\n}\n\n// Function to join a channel\nasync function joinChannel(channelName: string): Promise<void> {\n  if (!ws || ws.readyState !== WebSocket.OPEN) {\n    throw new Error(\"Not connected to Figma\");\n  }\n\n  try {\n    await sendCommandToFigma(\"join\", { channel: channelName });\n    currentChannel = channelName;\n    logger.info(`Joined channel: ${channelName}`);\n  } catch (error) {\n    logger.error(`Failed to join channel: ${error instanceof Error ? error.message : String(error)}`);\n    throw error;\n  }\n}\n\n// Function to send commands to Figma\nfunction sendCommandToFigma(\n  command: FigmaCommand,\n  params: unknown = {},\n  timeoutMs: number = 30000\n): Promise<unknown> {\n  return new Promise((resolve, reject) => {\n    // If not connected, try to connect first\n    if (!ws || ws.readyState !== WebSocket.OPEN) {\n      connectToFigma();\n      reject(new Error(\"Not connected to Figma. Attempting to connect...\"));\n      return;\n    }\n\n    // Check if we need a channel for this command\n    const requiresChannel = command !== \"join\";\n    if (requiresChannel && !currentChannel) {\n      reject(new Error(\"Must join a channel before sending commands\"));\n      return;\n    }\n\n    const id = uuidv4();\n    const request = {\n      id,\n      type: command === \"join\" ? \"join\" : \"message\",\n      ...(command === \"join\"\n        ? { channel: (params as any).channel }\n        : { channel: currentChannel }),\n      message: {\n        id,\n        command,\n        params: {\n          ...(params as any),\n          commandId: id, // Include the command ID in params\n        },\n      },\n    };\n\n    // Set timeout for request\n    const timeout = setTimeout(() => {\n      if (pendingRequests.has(id)) {\n        pendingRequests.delete(id);\n        logger.error(`Request ${id} to Figma timed out after ${timeoutMs / 1000} seconds`);\n        reject(new Error('Request to Figma timed out'));\n      }\n    }, timeoutMs);\n\n    // Store the promise callbacks to resolve/reject later\n    pendingRequests.set(id, {\n      resolve,\n      reject,\n      timeout,\n      lastActivity: Date.now()\n    });\n\n    // Send the request\n    logger.info(`Sending command to Figma: ${command}`);\n    logger.debug(`Request details: ${JSON.stringify(request)}`);\n    ws.send(JSON.stringify(request));\n  });\n}\n\n// Create Component Tool\nserver.tool(\n  \"create_component\",\n  \"Create a new component in Figma. Default: transparent fill, no stroke, no auto-layout. Same layout params as create_frame.\",\n  {\n    name: z.string().describe(\"Name for the component\"),\n    x: z.coerce.number().optional().describe(\"X position (default: 0)\"),\n    y: z.coerce.number().optional().describe(\"Y position (default: 0)\"),\n    width: z.coerce.number().optional().describe(\"Width (default: 100)\"),\n    height: z.coerce.number().optional().describe(\"Height (default: 100)\"),\n    parentId: z.string().optional().describe(\"Parent node ID to append into\"),\n    fillColor: flexJson(z.object({\n      r: z.coerce.number().min(0).max(1), g: z.coerce.number().min(0).max(1),\n      b: z.coerce.number().min(0).max(1), a: z.coerce.number().min(0).max(1).optional(),\n    }).optional()).describe(\"Fill color RGBA (0-1 each). Default: transparent. Example: {\\\"r\\\":1,\\\"g\\\":1,\\\"b\\\":1} for white\"),\n    strokeColor: flexJson(z.object({\n      r: z.coerce.number().min(0).max(1), g: z.coerce.number().min(0).max(1),\n      b: z.coerce.number().min(0).max(1), a: z.coerce.number().min(0).max(1).optional(),\n    }).optional()).describe(\"Stroke color RGBA (0-1 each). Default: no stroke. Example: {\\\"r\\\":0,\\\"g\\\":0,\\\"b\\\":0}\"),\n    strokeWeight: z.coerce.number().positive().optional().describe(\"Stroke weight. Only applied if strokeColor is set.\"),\n    cornerRadius: z.coerce.number().optional().describe(\"Corner radius\"),\n    layoutMode: z.enum([\"NONE\", \"HORIZONTAL\", \"VERTICAL\"]).optional().describe(\"Auto-layout direction (default: NONE)\"),\n    layoutWrap: z.enum([\"NO_WRAP\", \"WRAP\"]).optional().describe(\"Wrap children (default: NO_WRAP)\"),\n    paddingTop: z.coerce.number().optional().describe(\"Top padding (default: 0)\"),\n    paddingRight: z.coerce.number().optional().describe(\"Right padding (default: 0)\"),\n    paddingBottom: z.coerce.number().optional().describe(\"Bottom padding (default: 0)\"),\n    paddingLeft: z.coerce.number().optional().describe(\"Left padding (default: 0)\"),\n    primaryAxisAlignItems: z.enum([\"MIN\", \"MAX\", \"CENTER\", \"SPACE_BETWEEN\"]).optional().describe(\"Primary axis alignment (default: MIN)\"),\n    counterAxisAlignItems: z.enum([\"MIN\", \"MAX\", \"CENTER\", \"BASELINE\"]).optional().describe(\"Counter axis alignment (default: MIN)\"),\n    layoutSizingHorizontal: z.enum([\"FIXED\", \"HUG\", \"FILL\"]).optional().describe(\"Horizontal sizing (default: FIXED)\"),\n    layoutSizingVertical: z.enum([\"FIXED\", \"HUG\", \"FILL\"]).optional().describe(\"Vertical sizing (default: FIXED)\"),\n    itemSpacing: z.coerce.number().optional().describe(\"Spacing between children (default: 0)\"),\n  },\n  async ({ name, x, y, width, height, parentId, fillColor, strokeColor, strokeWeight, cornerRadius, layoutMode, layoutWrap, paddingTop, paddingRight, paddingBottom, paddingLeft, primaryAxisAlignItems, counterAxisAlignItems, layoutSizingHorizontal, layoutSizingVertical, itemSpacing }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"create_component\", { name, x, y, width, height, parentId, fillColor, strokeColor, strokeWeight, cornerRadius, layoutMode, layoutWrap, paddingTop, paddingRight, paddingBottom, paddingLeft, primaryAxisAlignItems, counterAxisAlignItems, layoutSizingHorizontal, layoutSizingVertical, itemSpacing });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error creating component: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Create Component From Node Tool\nserver.tool(\n  \"create_component_from_node\",\n  \"Convert an existing node into a component\",\n  {\n    nodeId: z.string().describe(\"The ID of the node to convert to a component\"),\n  },\n  async ({ nodeId }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"create_component_from_node\", { nodeId });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error creating component from node: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Combine As Variants Tool\nserver.tool(\n  \"combine_as_variants\",\n  \"Combine multiple components into a variant set\",\n  {\n    componentIds: flexJson(z.array(z.string())).describe(\"Array of component node IDs to combine. Example: [\\\"1:2\\\",\\\"1:3\\\"]\"),\n    name: z.string().optional().describe(\"Name for the component set\"),\n  },\n  async ({ componentIds, name }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"combine_as_variants\", { componentIds, name });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error combining variants: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Add Component Property Tool\nserver.tool(\n  \"add_component_property\",\n  \"Add a property to a component (BOOLEAN, TEXT, INSTANCE_SWAP, or VARIANT)\",\n  {\n    componentId: z.string().describe(\"The component node ID\"),\n    propertyName: z.string().describe(\"Name of the property\"),\n    type: z.enum([\"BOOLEAN\", \"TEXT\", \"INSTANCE_SWAP\", \"VARIANT\"]).describe(\"Type of the property\"),\n    defaultValue: flexBool(z.union([z.string(), z.boolean()])).describe(\"Default value — string for TEXT/VARIANT/INSTANCE_SWAP, boolean for BOOLEAN. Examples: \\\"Click me\\\", true\"),\n    preferredValues: flexJson(z.array(z.object({\n      type: z.enum([\"COMPONENT\", \"COMPONENT_SET\"]),\n      key: z.string(),\n    })).optional()).describe(\"Preferred values for INSTANCE_SWAP. Example: [{\\\"type\\\":\\\"COMPONENT\\\",\\\"key\\\":\\\"abc123\\\"}]\"),\n  },\n  async ({ componentId, propertyName, type, defaultValue, preferredValues }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"add_component_property\", { componentId, propertyName, type, defaultValue, preferredValues });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error adding component property: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Create Instance From Local Component Tool\nserver.tool(\n  \"create_instance_from_local\",\n  \"Create an instance of a local component by its node ID. Accepts both COMPONENT and COMPONENT_SET IDs (picks default variant).\",\n  {\n    componentId: z.string().describe(\"The node ID of the local component or component set to instantiate\"),\n    x: z.coerce.number().optional().describe(\"X position for the instance\"),\n    y: z.coerce.number().optional().describe(\"Y position for the instance\"),\n    parentId: z.string().optional().describe(\"Parent node ID to append to\"),\n  },\n  async ({ componentId, x, y, parentId }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"create_instance_from_local\", { componentId, x, y, parentId });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error creating instance: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Create Variable Collection Tool\nserver.tool(\n  \"create_variable_collection\",\n  \"Create a new variable collection for design tokens\",\n  {\n    name: z.string().describe(\"Name for the variable collection\"),\n  },\n  async ({ name }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"create_variable_collection\", { name });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error creating variable collection: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Create Variable Tool\nserver.tool(\n  \"create_variable\",\n  \"Create a new variable (design token) in a collection\",\n  {\n    collectionId: z.string().describe(\"The variable collection ID\"),\n    name: z.string().describe(\"Name for the variable\"),\n    resolvedType: z.enum([\"COLOR\", \"FLOAT\", \"STRING\", \"BOOLEAN\"]).describe(\"The variable type\"),\n  },\n  async ({ collectionId, name, resolvedType }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"create_variable\", { collectionId, name, resolvedType });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error creating variable: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Set Variable Value Tool\nserver.tool(\n  \"set_variable_value\",\n  \"Set a variable's value for a specific mode\",\n  {\n    variableId: z.string().describe(\"The variable ID\"),\n    modeId: z.string().describe(\"The mode ID to set the value for\"),\n    value: flexJson(z.union([\n      z.number(),\n      z.string(),\n      z.boolean(),\n      z.object({\n        r: z.coerce.number().describe(\"Red (0-1)\"),\n        g: z.coerce.number().describe(\"Green (0-1)\"),\n        b: z.coerce.number().describe(\"Blue (0-1)\"),\n        a: z.coerce.number().optional().describe(\"Alpha (0-1, default 1)\"),\n      }),\n    ])).describe(\"The value — number for FLOAT, string for STRING, boolean for BOOLEAN, {r,g,b,a} object (0-1) for COLOR. Example COLOR: {\\\"r\\\":0.2,\\\"g\\\":0.5,\\\"b\\\":1,\\\"a\\\":1}\"),\n  },\n  async ({ variableId, modeId, value }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"set_variable_value\", { variableId, modeId, value });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error setting variable value: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Add Mode Tool\nserver.tool(\n  \"add_mode\",\n  \"Add a new mode to a variable collection\",\n  {\n    collectionId: z.string().describe(\"The variable collection ID\"),\n    name: z.string().describe(\"Name for the new mode\"),\n  },\n  async ({ collectionId, name }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"add_mode\", { collectionId, name });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error adding mode: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Rename Mode Tool\nserver.tool(\n  \"rename_mode\",\n  \"Rename an existing mode in a variable collection\",\n  {\n    collectionId: z.string().describe(\"The variable collection ID\"),\n    modeId: z.string().describe(\"The mode ID to rename\"),\n    name: z.string().describe(\"New name for the mode\"),\n  },\n  async ({ collectionId, modeId, name }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"rename_mode\", { collectionId, modeId, name });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error renaming mode: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Remove Mode Tool\nserver.tool(\n  \"remove_mode\",\n  \"Remove a mode from a variable collection\",\n  {\n    collectionId: z.string().describe(\"The variable collection ID\"),\n    modeId: z.string().describe(\"The mode ID to remove\"),\n  },\n  async ({ collectionId, modeId }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"remove_mode\", { collectionId, modeId });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error removing mode: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Rename Page Tool\nserver.tool(\n  \"rename_page\",\n  \"Rename a page. Defaults to current page if no pageId given.\",\n  {\n    newName: z.string().describe(\"New name for the page\"),\n    pageId: z.string().optional().describe(\"Page ID to rename (defaults to current page)\"),\n  },\n  async ({ newName, pageId }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"rename_page\", { newName, pageId });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error renaming page: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Zoom Into View Tool\nserver.tool(\n  \"zoom_into_view\",\n  \"Scroll and zoom the viewport to fit specific nodes on screen (like pressing Shift+1). Use this to bring the user's attention to nodes you just created or modified.\",\n  {\n    nodeIds: flexJson(z.array(z.string())).describe(\"Array of node IDs to zoom into view. Example: [\\\"1:2\\\"]\"),\n  },\n  async ({ nodeIds }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"zoom_into_view\", { nodeIds });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error zooming into view: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Set Viewport Tool\nserver.tool(\n  \"set_viewport\",\n  \"Set the viewport center position and/or zoom level. Zoom 1.0 = 100%, 0.5 = 50%, 2.0 = 200%.\",\n  {\n    center: flexJson(z.object({\n      x: z.coerce.number().describe(\"X coordinate of viewport center\"),\n      y: z.coerce.number().describe(\"Y coordinate of viewport center\"),\n    }).optional()).describe(\"Viewport center point. Example: {\\\"x\\\":500,\\\"y\\\":300}\"),\n    zoom: z.coerce.number().min(0.01).max(256).optional().describe(\"Zoom level (1.0 = 100%)\"),\n  },\n  async ({ center, zoom }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"set_viewport\", { center, zoom });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error setting viewport: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Create Auto Layout Tool\nserver.tool(\n  \"create_auto_layout\",\n  \"Wrap existing nodes in an auto-layout frame. One call replaces create_frame + set_layout_mode + insert_child × N. Defaults to VERTICAL layout with HUG sizing.\",\n  {\n    nodeIds: flexJson(z.array(z.string())).describe(\"Array of node IDs to wrap. Example: [\\\"1:2\\\",\\\"1:3\\\"]\"),\n    name: z.string().optional().describe(\"Name for the frame (default 'Auto Layout')\"),\n    layoutMode: z.enum([\"HORIZONTAL\", \"VERTICAL\"]).optional().describe(\"Layout direction (default VERTICAL)\"),\n    itemSpacing: z.coerce.number().optional().describe(\"Spacing between children (default 0)\"),\n    paddingTop: z.coerce.number().optional().describe(\"Top padding (default: 0)\"),\n    paddingRight: z.coerce.number().optional().describe(\"Right padding (default: 0)\"),\n    paddingBottom: z.coerce.number().optional().describe(\"Bottom padding (default: 0)\"),\n    paddingLeft: z.coerce.number().optional().describe(\"Left padding (default: 0)\"),\n    primaryAxisAlignItems: z.enum([\"MIN\", \"MAX\", \"CENTER\", \"SPACE_BETWEEN\"]).optional().describe(\"Primary axis alignment (default: MIN)\"),\n    counterAxisAlignItems: z.enum([\"MIN\", \"MAX\", \"CENTER\", \"BASELINE\"]).optional().describe(\"Counter axis alignment (default: MIN)\"),\n    layoutSizingHorizontal: z.enum([\"FIXED\", \"HUG\", \"FILL\"]).optional().describe(\"Horizontal sizing (default: HUG)\"),\n    layoutSizingVertical: z.enum([\"FIXED\", \"HUG\", \"FILL\"]).optional().describe(\"Vertical sizing (default: HUG)\"),\n    layoutWrap: z.enum([\"NO_WRAP\", \"WRAP\"]).optional().describe(\"Wrap children (default: NO_WRAP)\"),\n  },\n  async ({ nodeIds, name, layoutMode, itemSpacing, paddingTop, paddingRight, paddingBottom, paddingLeft, primaryAxisAlignItems, counterAxisAlignItems, layoutSizingHorizontal, layoutSizingVertical, layoutWrap }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"create_auto_layout\", { nodeIds, name, layoutMode, itemSpacing, paddingTop, paddingRight, paddingBottom, paddingLeft, primaryAxisAlignItems, counterAxisAlignItems, layoutSizingHorizontal, layoutSizingVertical, layoutWrap });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error creating auto layout: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Get Local Variables Tool\nserver.tool(\n  \"get_local_variables\",\n  \"List local variables (names, IDs, types only - no values). Use collectionId to browse a specific collection's contents. Use get_variable_by_id for full values.\",\n  {\n    type: z.enum([\"COLOR\", \"FLOAT\", \"STRING\", \"BOOLEAN\"]).optional().describe(\"Filter by variable type\"),\n    collectionId: z.string().optional().describe(\"Filter to variables in this collection only\"),\n  },\n  async ({ type, collectionId }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"get_local_variables\", { type, collectionId });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error getting variables: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Get Local Variable Collections Tool\nserver.tool(\n  \"get_local_variable_collections\",\n  \"List all local variable collections\",\n  {},\n  async () => {\n    try {\n      const result = await sendCommandToFigma(\"get_local_variable_collections\");\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error getting variable collections: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Set Variable Binding Tool\nserver.tool(\n  \"set_variable_binding\",\n  \"Bind a variable to a node property. For scalar fields use the field name directly (e.g., 'opacity', 'itemSpacing', 'cornerRadius'). For paint colors use 'fills/0/color' or 'strokes/0/color' syntax.\",\n  {\n    nodeId: z.string().describe(\"The node ID to bind the variable to\"),\n    field: z.string().describe(\"Property field: scalar fields like 'opacity', 'width', 'itemSpacing', 'paddingLeft', 'visible', 'topLeftRadius', 'strokeWeight'; or paint color fields like 'fills/0/color', 'strokes/0/color'\"),\n    variableId: z.string().describe(\"The variable ID to bind\"),\n  },\n  async ({ nodeId, field, variableId }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"set_variable_binding\", { nodeId, field, variableId });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error binding variable: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Create Paint Style Tool\nserver.tool(\n  \"create_paint_style\",\n  \"Create a color/paint style\",\n  {\n    name: z.string().describe(\"Name for the paint style\"),\n    color: flexJson(z.object({\n      r: z.coerce.number().describe(\"Red (0-1)\"),\n      g: z.coerce.number().describe(\"Green (0-1)\"),\n      b: z.coerce.number().describe(\"Blue (0-1)\"),\n      a: z.coerce.number().optional().describe(\"Alpha (0-1, default 1)\"),\n    })).describe(\"Color RGBA (0-1 each). Example: {\\\"r\\\":0.2,\\\"g\\\":0.5,\\\"b\\\":1} — omit a for full opacity\"),\n  },\n  async ({ name, color }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"create_paint_style\", { name, color });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error creating paint style: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Create Text Style Tool\nserver.tool(\n  \"create_text_style\",\n  \"Create a text style with font properties\",\n  {\n    name: z.string().describe(\"Name for the text style\"),\n    fontFamily: z.string().describe(\"Font family name\"),\n    fontStyle: z.string().optional().describe(\"Font style (e.g., 'Regular', 'Bold', 'Italic') (default: 'Regular')\"),\n    fontSize: z.coerce.number().describe(\"Font size in pixels\"),\n    lineHeight: flexNum(z.union([\n      z.number(),\n      z.object({\n        value: z.coerce.number(),\n        unit: z.enum([\"PIXELS\", \"PERCENT\", \"AUTO\"]),\n      }),\n    ]).optional()).describe(\"Line height — number (pixels) or {value, unit}. Examples: 24, {\\\"value\\\":150,\\\"unit\\\":\\\"PERCENT\\\"}\"),\n    letterSpacing: flexNum(z.union([\n      z.number(),\n      z.object({\n        value: z.coerce.number(),\n        unit: z.enum([\"PIXELS\", \"PERCENT\"]),\n      }),\n    ]).optional()).describe(\"Letter spacing — number (pixels) or {value, unit}. Examples: 0.5, {\\\"value\\\":2,\\\"unit\\\":\\\"PERCENT\\\"}\"),\n    textCase: z.enum([\"ORIGINAL\", \"UPPER\", \"LOWER\", \"TITLE\"]).optional().describe(\"Text case transform\"),\n    textDecoration: z.enum([\"NONE\", \"UNDERLINE\", \"STRIKETHROUGH\"]).optional().describe(\"Text decoration\"),\n  },\n  async ({ name, fontFamily, fontStyle, fontSize, lineHeight, letterSpacing, textCase, textDecoration }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"create_text_style\", { name, fontFamily, fontStyle, fontSize, lineHeight, letterSpacing, textCase, textDecoration });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error creating text style: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Create Effect Style Tool\nserver.tool(\n  \"create_effect_style\",\n  \"Create an effect style (shadows, blurs)\",\n  {\n    name: z.string().describe(\"Name for the effect style\"),\n    effects: flexJson(z.array(z.object({\n      type: z.enum([\"DROP_SHADOW\", \"INNER_SHADOW\", \"LAYER_BLUR\", \"BACKGROUND_BLUR\"]).describe(\"Effect type\"),\n      color: z.object({\n        r: z.coerce.number(), g: z.coerce.number(), b: z.coerce.number(), a: z.coerce.number().optional(),\n      }).optional().describe(\"Effect color RGBA (0-1). Example: {\\\"r\\\":0,\\\"g\\\":0,\\\"b\\\":0,\\\"a\\\":0.25}\"),\n      offset: z.object({\n        x: z.coerce.number(), y: z.coerce.number(),\n      }).optional().describe(\"Shadow offset. Example: {\\\"x\\\":0,\\\"y\\\":4}\"),\n      radius: z.coerce.number().describe(\"Blur radius\"),\n      spread: z.coerce.number().optional().describe(\"Shadow spread\"),\n      visible: flexBool(z.boolean().optional()).describe(\"Whether effect is visible (default true)\"),\n      blendMode: z.enum([\"NORMAL\", \"DARKEN\", \"MULTIPLY\", \"COLOR_BURN\", \"LIGHTEN\", \"SCREEN\", \"COLOR_DODGE\", \"OVERLAY\", \"SOFT_LIGHT\", \"HARD_LIGHT\", \"DIFFERENCE\", \"EXCLUSION\", \"HUE\", \"SATURATION\", \"COLOR\", \"LUMINOSITY\"]).optional().describe(\"Blend mode for shadows (default NORMAL)\"),\n    }))).describe(\"Array of effects. Example: [{\\\"type\\\":\\\"DROP_SHADOW\\\",\\\"color\\\":{\\\"r\\\":0,\\\"g\\\":0,\\\"b\\\":0,\\\"a\\\":0.25},\\\"offset\\\":{\\\"x\\\":0,\\\"y\\\":4},\\\"radius\\\":4}]\"),\n  },\n  async ({ name, effects }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"create_effect_style\", { name, effects });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error creating effect style: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Apply Style To Node Tool\nserver.tool(\n  \"apply_style_to_node\",\n  \"Apply a style to a node by ID or name. Provide either styleId or styleName (name supports case-insensitive substring match).\",\n  {\n    nodeId: z.string().describe(\"The node ID to apply the style to\"),\n    styleId: z.string().optional().describe(\"The style ID to apply (from create_paint_style, create_text_style, etc.)\"),\n    styleName: z.string().optional().describe(\"Style name to look up (e.g., \\\"Heading/Large Title\\\"). Case-insensitive substring match. Use instead of styleId for convenience.\"),\n    styleType: z.enum([\"fill\", \"stroke\", \"text\", \"effect\"]).describe(\"Type of style to apply\"),\n  },\n  async ({ nodeId, styleId, styleName, styleType }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"apply_style_to_node\", { nodeId, styleId, styleName, styleType });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error applying style: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Create Ellipse Tool\nserver.tool(\n  \"create_ellipse\",\n  \"Create an ellipse/circle in Figma. Default: white fill (Figma native). Use equal width/height for a circle.\",\n  {\n    x: z.coerce.number().optional().describe(\"X position (default: 0)\"),\n    y: z.coerce.number().optional().describe(\"Y position (default: 0)\"),\n    width: z.coerce.number().optional().describe(\"Width (default: 100)\"),\n    height: z.coerce.number().optional().describe(\"Height (default: 100)\"),\n    name: z.string().optional().describe(\"Name for the ellipse\"),\n    parentId: z.string().optional().describe(\"Parent node ID to append into\"),\n  },\n  async ({ x, y, width, height, name, parentId }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"create_ellipse\", { x, y, width, height, name, parentId });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error creating ellipse: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Create Line Tool\nserver.tool(\n  \"create_line\",\n  \"Create a line in Figma. Default: black stroke.\",\n  {\n    x: z.coerce.number().optional().describe(\"X position (default: 0)\"),\n    y: z.coerce.number().optional().describe(\"Y position (default: 0)\"),\n    length: z.coerce.number().optional().describe(\"Length of the line (default: 100)\"),\n    rotation: z.coerce.number().optional().describe(\"Rotation in degrees (default: 0)\"),\n    name: z.string().optional().describe(\"Name for the line\"),\n    parentId: z.string().optional().describe(\"Parent node ID to append into\"),\n  },\n  async ({ x, y, length, rotation, name, parentId }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"create_line\", { x, y, length, rotation, name, parentId });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error creating line: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Create Boolean Operation Tool\nserver.tool(\n  \"create_boolean_operation\",\n  \"Create a boolean operation (union, intersect, subtract, exclude) from multiple nodes\",\n  {\n    nodeIds: flexJson(z.array(z.string())).describe(\"Array of node IDs to combine. Example: [\\\"1:2\\\",\\\"1:3\\\"]\"),\n    operation: z.enum([\"UNION\", \"INTERSECT\", \"SUBTRACT\", \"EXCLUDE\"]).describe(\"Boolean operation type\"),\n    name: z.string().optional().describe(\"Name for the resulting node\"),\n  },\n  async ({ nodeIds, operation, name }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"create_boolean_operation\", { nodeIds, operation, name });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error creating boolean operation: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Set Opacity Tool\nserver.tool(\n  \"set_opacity\",\n  \"Set the opacity of a node\",\n  {\n    nodeId: z.string().describe(\"The node ID\"),\n    opacity: z.coerce.number().min(0).max(1).describe(\"Opacity value (0-1)\"),\n  },\n  async ({ nodeId, opacity }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"set_opacity\", { nodeId, opacity });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error setting opacity: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Set Effects Tool\nserver.tool(\n  \"set_effects\",\n  \"Set effects (shadows, blurs) on a node\",\n  {\n    nodeId: z.string().describe(\"The node ID\"),\n    effects: flexJson(z.array(z.object({\n      type: z.enum([\"DROP_SHADOW\", \"INNER_SHADOW\", \"LAYER_BLUR\", \"BACKGROUND_BLUR\"]).describe(\"Effect type\"),\n      color: z.object({\n        r: z.coerce.number(), g: z.coerce.number(), b: z.coerce.number(), a: z.coerce.number().optional(),\n      }).optional().describe(\"Effect color RGBA (0-1). Example: {\\\"r\\\":0,\\\"g\\\":0,\\\"b\\\":0,\\\"a\\\":0.25}\"),\n      offset: z.object({\n        x: z.coerce.number(), y: z.coerce.number(),\n      }).optional().describe(\"Shadow offset. Example: {\\\"x\\\":0,\\\"y\\\":4}\"),\n      radius: z.coerce.number().describe(\"Blur radius\"),\n      spread: z.coerce.number().optional().describe(\"Shadow spread\"),\n      visible: flexBool(z.boolean().optional()).describe(\"Whether effect is visible (default true)\"),\n      blendMode: z.enum([\"NORMAL\", \"DARKEN\", \"MULTIPLY\", \"COLOR_BURN\", \"LIGHTEN\", \"SCREEN\", \"COLOR_DODGE\", \"OVERLAY\", \"SOFT_LIGHT\", \"HARD_LIGHT\", \"DIFFERENCE\", \"EXCLUSION\", \"HUE\", \"SATURATION\", \"COLOR\", \"LUMINOSITY\"]).optional().describe(\"Blend mode for shadows (default NORMAL)\"),\n    }))).describe(\"Array of effects. Example: [{\\\"type\\\":\\\"DROP_SHADOW\\\",\\\"color\\\":{\\\"r\\\":0,\\\"g\\\":0,\\\"b\\\":0,\\\"a\\\":0.25},\\\"offset\\\":{\\\"x\\\":0,\\\"y\\\":4},\\\"radius\\\":4}]\"),\n  },\n  async ({ nodeId, effects }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"set_effects\", { nodeId, effects });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error setting effects: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Set Constraints Tool\nserver.tool(\n  \"set_constraints\",\n  \"Set layout constraints on a node\",\n  {\n    nodeId: z.string().describe(\"The node ID\"),\n    horizontal: z.enum([\"MIN\", \"CENTER\", \"MAX\", \"STRETCH\", \"SCALE\"]).describe(\"Horizontal constraint\"),\n    vertical: z.enum([\"MIN\", \"CENTER\", \"MAX\", \"STRETCH\", \"SCALE\"]).describe(\"Vertical constraint\"),\n  },\n  async ({ nodeId, horizontal, vertical }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"set_constraints\", { nodeId, horizontal, vertical });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error setting constraints: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Set Export Settings Tool\nserver.tool(\n  \"set_export_settings\",\n  \"Set export settings on a node\",\n  {\n    nodeId: z.string().describe(\"The node ID\"),\n    settings: flexJson(z.array(z.object({\n      format: z.enum([\"PNG\", \"JPG\", \"SVG\", \"PDF\"]).describe(\"Export format\"),\n      suffix: z.string().optional().describe(\"File suffix\"),\n      contentsOnly: flexBool(z.boolean().optional()).describe(\"Export contents only (default true)\"),\n      constraint: z.object({\n        type: z.enum([\"SCALE\", \"WIDTH\", \"HEIGHT\"]).describe(\"Constraint type\"),\n        value: z.coerce.number().describe(\"Constraint value\"),\n      }).optional().describe(\"Export constraint. Example: {\\\"type\\\":\\\"SCALE\\\",\\\"value\\\":2}\"),\n    }))).describe(\"Array of export settings. Example: [{\\\"format\\\":\\\"PNG\\\",\\\"constraint\\\":{\\\"type\\\":\\\"SCALE\\\",\\\"value\\\":2}}]\"),\n  },\n  async ({ nodeId, settings }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"set_export_settings\", { nodeId, settings });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error setting export settings: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Set Node Properties Tool\nserver.tool(\n  \"set_node_properties\",\n  \"Batch-set multiple properties on a node at once\",\n  {\n    nodeId: z.string().describe(\"The node ID\"),\n    properties: flexJson(z.record(z.unknown())).describe(\"Object of property key-value pairs. Example: {\\\"opacity\\\":0.5,\\\"visible\\\":false,\\\"locked\\\":true}\"),\n  },\n  async ({ nodeId, properties }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"set_node_properties\", { nodeId, properties });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error setting node properties: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Get Style By ID Tool\nserver.tool(\n  \"get_style_by_id\",\n  \"Get detailed information about a specific style by its ID. Returns full paint/font/effect/grid details.\",\n  {\n    styleId: z.string().describe(\"The style ID to look up\"),\n  },\n  async ({ styleId }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"get_style_by_id\", { styleId });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error getting style: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Remove Style Tool\nserver.tool(\n  \"remove_style\",\n  \"Delete/remove a style from the document by its ID\",\n  {\n    styleId: z.string().describe(\"The style ID to remove\"),\n  },\n  async ({ styleId }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"remove_style\", { styleId });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error removing style: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Get Component By ID Tool\nserver.tool(\n  \"get_component_by_id\",\n  \"Get detailed information about a component including property definitions and variant group properties. For COMPONENT_SETs, variant children are omitted by default (use includeChildren=true to list them) since propertyDefinitions already describes the full variant space.\",\n  {\n    componentId: z.string().describe(\"The component node ID\"),\n    includeChildren: flexBool(z.boolean().optional()).describe(\"For COMPONENT_SETs: include variant children list (default false). Plain COMPONENTs always include children.\"),\n  },\n  async ({ componentId, includeChildren }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"get_component_by_id\", { componentId, includeChildren });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error getting component: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Get Variable By ID Tool\nserver.tool(\n  \"get_variable_by_id\",\n  \"Get detailed information about a variable by its ID, including all mode values.\",\n  {\n    variableId: z.string().describe(\"The variable ID\"),\n  },\n  async ({ variableId }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"get_variable_by_id\", { variableId });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error getting variable: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Get Variable Collection By ID Tool\nserver.tool(\n  \"get_variable_collection_by_id\",\n  \"Get detailed information about a variable collection by its ID, including modes and variable IDs.\",\n  {\n    collectionId: z.string().describe(\"The variable collection ID\"),\n  },\n  async ({ collectionId }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"get_variable_collection_by_id\", { collectionId });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error getting variable collection: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Get Pages Tool\nserver.tool(\n  \"get_pages\",\n  \"Get all pages in the document with their IDs, names, and child counts.\",\n  {},\n  async () => {\n    try {\n      const result = await sendCommandToFigma(\"get_pages\");\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error getting pages: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Set Current Page Tool\nserver.tool(\n  \"set_current_page\",\n  \"Switch to a different page. Provide either pageId or pageName (at least one required).\",\n  {\n    pageId: z.string().optional().describe(\"The page ID to switch to\"),\n    pageName: z.string().optional().describe(\"The page name to switch to (case-insensitive, supports partial match)\"),\n  },\n  async ({ pageId, pageName }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"set_current_page\", { pageId, pageName });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error setting current page: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Create Page Tool\nserver.tool(\n  \"create_page\",\n  \"Create a new page in the document\",\n  {\n    name: z.string().optional().describe(\"Name for the new page (default: 'New Page')\"),\n  },\n  async ({ name }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"create_page\", { name });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error creating page: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Get Node CSS Tool\nserver.tool(\n  \"get_node_css\",\n  \"Get CSS properties for a node (useful for dev handoff)\",\n  {\n    nodeId: z.string().describe(\"The node ID to get CSS for\"),\n  },\n  async ({ nodeId }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"get_node_css\", { nodeId });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error getting CSS: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Get Available Fonts Tool\nserver.tool(\n  \"get_available_fonts\",\n  \"List available fonts in Figma, grouped by family. Use query to filter by family name (e.g., 'Inter', 'SF Pro'). Without query, returns ALL fonts — use query to avoid large responses.\",\n  {\n    query: z.string().optional().describe(\"Filter font families by name (case-insensitive substring match). Strongly recommended.\"),\n  },\n  async ({ query }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"get_available_fonts\", { query });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error getting fonts: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Create Section Tool\nserver.tool(\n  \"create_section\",\n  \"Create a section node to organize content on the canvas. Sections are top-level containers.\",\n  {\n    x: z.coerce.number().optional().describe(\"X position (default: 0)\"),\n    y: z.coerce.number().optional().describe(\"Y position (default: 0)\"),\n    width: z.coerce.number().optional().describe(\"Width (default: 500)\"),\n    height: z.coerce.number().optional().describe(\"Height (default: 500)\"),\n    name: z.string().optional().describe(\"Name for the section (default: 'Section')\"),\n    parentId: z.string().optional().describe(\"Parent node ID\"),\n  },\n  async ({ x, y, width, height, name, parentId }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"create_section\", { x, y, width, height, name, parentId });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error creating section: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Insert Child Tool\nserver.tool(\n  \"insert_child\",\n  \"Move a node into a parent at a specific index (reorder/reparent)\",\n  {\n    parentId: z.string().describe(\"The parent node ID\"),\n    childId: z.string().describe(\"The child node ID to move\"),\n    index: z.coerce.number().optional().describe(\"Index to insert at (0=first). Omit to append at end.\"),\n  },\n  async ({ parentId, childId, index }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"insert_child\", { parentId, childId, index });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error inserting child: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Create Node From SVG Tool\nserver.tool(\n  \"create_node_from_svg\",\n  \"Create a node from an SVG string\",\n  {\n    svg: z.string().describe(\"SVG markup string\"),\n    x: z.coerce.number().optional().describe(\"X position (default 0)\"),\n    y: z.coerce.number().optional().describe(\"Y position (default 0)\"),\n    name: z.string().optional().describe(\"Name for the node\"),\n    parentId: z.string().optional().describe(\"Parent node ID\"),\n  },\n  async ({ svg, x, y, name, parentId }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"create_node_from_svg\", { svg, x, y, name, parentId });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error creating node from SVG: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Get Current Page Tool - always safe, never touches unloaded pages\nserver.tool(\n  \"get_current_page\",\n  \"Get the current page info and its top-level children. Always safe - never touches unloaded pages. Use this as the entry point for exploring large files.\",\n  {},\n  async () => {\n    try {\n      const result = await sendCommandToFigma(\"get_current_page\");\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error getting current page: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Search Nodes Tool\nserver.tool(\n  \"search_nodes\",\n  \"Search for nodes by name and/or type within a scope. Returns paginated results with parent info and bounds.\",\n  {\n    query: z.string().optional().describe(\"Search string to match against node names (case-insensitive substring match)\"),\n    types: flexJson(z.array(z.string()).optional()).describe(\"Filter by node types. Example: [\\\"FRAME\\\",\\\"COMPONENT\\\",\\\"TEXT\\\",\\\"INSTANCE\\\"]\"),\n    scopeNodeId: z.string().optional().describe(\"Node ID to search within (defaults to current page)\"),\n    caseSensitive: flexBool(z.boolean().optional()).describe(\"If true, name matching is case-sensitive (default false)\"),\n    limit: z.coerce.number().optional().describe(\"Max results to return (default 50)\"),\n    offset: z.coerce.number().optional().describe(\"Skip this many results for pagination (default 0)\"),\n  },\n  async ({ query, types, scopeNodeId, caseSensitive, limit, offset }: any) => {\n    try {\n      const result = await sendCommandToFigma(\"search_nodes\", { query, types, scopeNodeId, caseSensitive, limit, offset });\n      return { content: [{ type: \"text\", text: JSON.stringify(result) }] };\n    } catch (error) {\n      return { content: [{ type: \"text\", text: `Error searching nodes: ${error instanceof Error ? error.message : String(error)}` }] };\n    }\n  }\n);\n\n// Update the join_channel tool\nserver.tool(\n  \"join_channel\",\n  \"Join a specific channel to communicate with Figma\",\n  {\n    channel: z.string().describe(\"The name of the channel to join\").default(\"\"),\n  },\n  async ({ channel }: any) => {\n    try {\n      if (!channel) {\n        // If no channel provided, ask the user for input\n        return {\n          content: [\n            {\n              type: \"text\",\n              text: \"Please provide a channel name to join:\",\n            },\n          ],\n          followUp: {\n            tool: \"join_channel\",\n            description: \"Join the specified channel\",\n          },\n        };\n      }\n\n      await joinChannel(channel);\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Successfully joined channel: ${channel}`,\n          },\n        ],\n      };\n    } catch (error) {\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: `Error joining channel: ${error instanceof Error ? error.message : String(error)\n              }`,\n          },\n        ],\n      };\n    }\n  }\n);\n\n// Start the server\nasync function main() {\n  try {\n    // Try to connect to Figma socket server\n    connectToFigma();\n  } catch (error) {\n    logger.warn(`Could not connect to Figma initially: ${error instanceof Error ? error.message : String(error)}`);\n    logger.warn('Will try to connect when the first command is sent');\n  }\n\n  // Start the MCP server with stdio transport\n  const transport = new StdioServerTransport();\n  await server.connect(transport);\n  logger.info('FigmaMCP server running on stdio');\n}\n\n// Run the server\nmain().catch(error => {\n  logger.error(`Error starting FigmaMCP server: ${error instanceof Error ? error.message : String(error)}`);\n  process.exit(1);\n});\n\n\n\n"],"mappings":"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","names":["WebSocket","uuidv4"]}